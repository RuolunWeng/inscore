CMAKE    = ../cmake
GFONT    = ../src/guido2.ttf
APP_PATH = $(CMAKE)/Release
APP      = InterludeSceneViewer
QT_PLUGIN_PATH = /Developer/Applications/Qt/plugins/
QT_FRAMEWORK_PATH = /Library/Frameworks
INTERLUDE_BUNDLE_VERSION = $(shell grep 'ITLFWKVERS' $(CMAKE)/CMakeLists.txt  | sed 's/[^0-9.]//g')
QT_VERSION = 4
GUIDO_VERSION = B
MAC_DEPLOY_TOOL = macdeployqt-4.6

interludeBundle:
	echo making bundle for version $(INTERLUDE_BUNDLE_VERSION)
	# Copy the application here
	rm -Rf $(APP).app
	cp -Rf $(APP_PATH)/$(APP).app .
	$(MAC_DEPLOY_TOOL) $(APP).app

	# Create the bundle's directories
#	make mkdirTry DIR=$(APP).app/Contents/Resources
#	make mkdirTry DIR=$(APP).app/Contents/Frameworks
#	make mkdirTry DIR=$(APP).app/Contents/Plugins/imageformats

	# Copy and link the application to its frameworks
	make installFramework APP=$(APP) FWORK=GUIDOEngine    FWORK_PATH=$(HOME)/Library/Frameworks FWORK_VERSION=$(GUIDO_VERSION)
	make installFramework APP=$(APP) FWORK=Interlude      FWORK_PATH=$(CMAKE)/Release           FWORK_VERSION=$(INTERLUDE_BUNDLE_VERSION)

	# Link the frameworks between them
	make linkFramework2Framework APP=$(APP) FWORK_1=Interlude FWORK_1_VERSION=$(INTERLUDE_BUNDLE_VERSION) FWORK_2=GUIDOEngine    FWORK_2_VERSION=$(GUIDO_VERSION)

	# Other resources
	cp $(GFONT) $(APP).app/Contents/Resources/guido2.ttf
	@ echo "Done." ;
