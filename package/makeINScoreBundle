
BUILD    = ../build
GFONT    = ../src/guido2.ttf
APP_PATH = $(BUILD)/macos/Release
APP      = INScoreViewer
INSCORE_BUNDLE_VERSION = $(shell grep 'INSFWKVERS' $(BUILD)/CMakeLists.txt  | sed 's/[^0-9.]//g')
GUIDO_VERSION = C
MAC_DEPLOY_TOOL = macdeployqt

bundle:
	echo making bundle for version $(INSCORE_BUNDLE_VERSION)
	# Copy the application here
	rm -Rf $(APP).app
	cp -Rf $(APP_PATH)/$(APP).app .
	$(MAC_DEPLOY_TOOL) $(APP).app


	# Copy and link the application to its frameworks
	make installFramework APP=$(APP) FWORK=GUIDOEngine    FWORK_PATH=../lib/GuidoEngine/macosx FWORK_VERSION=$(GUIDO_VERSION)
	make installFramework APP=$(APP) FWORK=INScore      FWORK_PATH=$(BUILD)/Release           FWORK_VERSION=$(INSCORE_BUNDLE_VERSION)

	# Link the frameworks between them
	make linkFramework2Framework APP=$(APP) FWORK_1=INScore FWORK_1_VERSION=$(INSCORE_BUNDLE_VERSION) FWORK_2=GUIDOEngine    FWORK_2_VERSION=$(GUIDO_VERSION)

	# Other resources
	cp $(GFONT) $(APP).app/Contents/Resources/guido2.ttf
	@ echo "Done." ;
