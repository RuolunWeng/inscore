CMAKE    = ../cmake
GFONT    = ../src/guido2.ttf
APP_PATH = $(CMAKE)/Release
APP      = INScoreViewer
QT_PLUGIN_PATH = /Developer/Applications/Qt/plugins/
QT_FRAMEWORK_PATH = /Library/Frameworks
INSCORE_BUNDLE_VERSION = $(shell grep 'INSFWKVERS' $(CMAKE)/CMakeLists.txt  | sed 's/[^0-9.]//g')
QT_VERSION = 4
GUIDO_VERSION = C
MAC_DEPLOY_TOOL = macdeployqt

bundle:
	echo making bundle for version $(INSCORE_BUNDLE_VERSION)
	# Copy the application here
	rm -Rf $(APP).app
	cp -Rf $(APP_PATH)/$(APP).app .
	$(MAC_DEPLOY_TOOL) $(APP).app

	# Create the bundle's directories
#	make mkdirTry DIR=$(APP).app/Contents/Resources
#	make mkdirTry DIR=$(APP).app/Contents/Frameworks
#	make mkdirTry DIR=$(APP).app/Contents/Plugins/imageformats

	# Copy and link the application to its frameworks
	make installFramework APP=$(APP) FWORK=GUIDOEngine    FWORK_PATH=../lib/GuidoEngine/macosx FWORK_VERSION=$(GUIDO_VERSION)
	make installFramework APP=$(APP) FWORK=INScore      FWORK_PATH=$(CMAKE)/Release           FWORK_VERSION=$(INSCORE_BUNDLE_VERSION)

	# Link the frameworks between them
	make linkFramework2Framework APP=$(APP) FWORK_1=INScore FWORK_1_VERSION=$(INSCORE_BUNDLE_VERSION) FWORK_2=GUIDOEngine    FWORK_2_VERSION=$(GUIDO_VERSION)

	# Other resources
	cp $(GFONT) $(APP).app/Contents/Resources/guido2.ttf
	@ echo "Done." ;
