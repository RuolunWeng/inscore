<!DOCTYPE html>
<!-- saved from url=(0062)https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide -->
<html lang="en" dir="ltr" id="developer-mozilla-org"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>JSAPI User Guide - MDN</title>

<meta charset="utf-8">

<meta name="MSSmartTagsPreventParsing" content="true">
<meta name="Copyright" content="Copyright (c) 2005-2011 Mozilla.">
<meta name="Rating" content="General">

<link rel="home" href="https://developer.mozilla.org/">
<link rel="copyright" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#copyright">
<meta name="robots" content="index,follow">
<link rel="shortcut icon" href="https://developer.mozilla.org/favicon.ico">
<link rel="alternate" type="application/rss+xml" title="What&#39;s new feed" href="https://developer.mozilla.org/index.php?title=Special:Recentchanges&feed=rss">
<link rel="alternate" type="application/rss+xml" title="Page and subpages changes feed" href="https://developer.mozilla.org/index.php?title=Special:Article&type=feed&feedtype=subpagechanges&pageid=8704">
<link rel="alternate" type="application/rss+xml" title="Page changes feed" href="https://developer.mozilla.org/index.php?title=Special:Article&type=feed&pageid=8704">
<meta name="generator" content="MindTouch">
<link rel="search" type="application/opensearchdescription+xml" title="MDN Search" href="https://developer.mozilla.org/deki/gui/opensearch.php?type=description">
<link rel="stylesheet" type="text/css" media="screen" href="./JSAPI User Guide - MDN_files/css.php"> <!--[if IE 7]><style type="text/css">@import "/skins/common/_ie7.css";</style><![endif]--><!--[if IE 6]><style type="text/css">@import "/skins/common/_ie.css";</style><![endif]--><link rel="stylesheet" type="text/css" media="print" href="./JSAPI User Guide - MDN_files/print.css">
<link rel="stylesheet" type="text/css" media="screen,projection" href="./JSAPI User Guide - MDN_files/css(1).php">
<!--[if lte IE 7]><link rel="stylesheet" type="text/css" media="all" href="/skins/mdn/Transitional/ie7.css"><![endif]-->
<!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="all" href="/skins/mdn/Transitional/ie6.css"><![endif]-->
<link rel="stylesheet" type="text/css" media="print" href="./JSAPI User Guide - MDN_files/print(1).css">

<script type="text/javascript">CKEDITOR_BASEPATH = "/deki/plugins/page_editor_ckeditor/ckeditor/";</script>
<script type="text/javascript" src="./JSAPI User Guide - MDN_files/js.php"></script><script type="text/javascript">var _starttime = new Date().getTime();</script>

<!--[if IE]>
<meta http-equiv="imagetoolbar" content="no">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<script src="/skins/mdn/Transitional/js/html5.js"></script>
<![endif]-->

	<script type="text/javascript">

		var aLt = aLt || [];aLt["attach-no-description"] = 'No description'; aLt["cancel"] = 'Cancel'; aLt["close"] = 'Close'; aLt["comment-delete"] = 'Are you sure you want to delete this comment?'; aLt["contentrating-title-popup"] = 'Thanks for your feedback'; aLt["error"] = 'Error'; aLt["error-permission-denied"] = 'Permission denied'; aLt["error-permission-details"] = 'Your account does not have sufficient permissions to perform that action.'; aLt["gallery-close"] = 'close'; aLt["gallery-next"] = 'next'; aLt["gallery-prev"] = 'prev'; aLt["internal-error"] = 'Sorry, but there was an internal problem - please try again soon.'; aLt["js-label_cancel"] = 'Cancel'; aLt["js-label_save"] = 'Save'; aLt["js-tooltip_cancel"] = 'Exit Without Saving Changes'; aLt["js-tooltip_save"] = 'Save and Exit (Alt+S)'; aLt["ldap-provide-credentials"] = 'Please provide external service login credentials.'; aLt["loading"] = 'Loading...'; aLt["menu-confirm-delete"] = 'Are you sure you want to delete this file?'; aLt["menu-delete-file"] = 'Delete'; aLt["menu-edit-description"] = 'Edit description'; aLt["menu-move-file"] = 'Move'; aLt["menu-previous-versions"] = 'Previous versions'; aLt["menu-view-original"] = 'View original'; aLt["ready"] = 'Ready'; aLt["remove-tag"] = 'Remove tag'; aLt["restore-tag"] = 'Restore tag'; aLt["adding-tags"] = 'Adding Tags...'; aLt["save"] = 'Save'; aLt["submit"] = 'Submit'; aLt["wikibits-attach-another"] = 'Attach another file'; aLt["wikibits-attach-file"] = 'Attach File'; aLt["wikibits-cant-attach-editing"] = 'Sorry, you can\'t attach files while editing a page. Please close the editor first.'; aLt["wikibits-edit-section"] = 'Edit section'; aLt["wikibits-remove-file"] = 'Remove file'; aLt["advanced-search"] = 'Advanced Search'; aLt["standard-search"] = 'Standard Search';  var wfMsg = wfMsg || function (key) { return aLt[key] ? aLt[key] : 'MISSING: ' + key; };
	//hook in menu clicking events to the document's body
	YAHOO.util.Event.addListener(document, "click", function () { DWMenu.BodyClick(); });
	YAHOO.util.Event.onDOMReady(function () { new clientWindow });

		

			YAHOO.util.Event.onDOMReady(function() {
			tb_init("a.lightbox, area.lightbox, input.lightbox, a[rel='awesomebox']");//pass where to apply thickbox
		});
	
			YAHOO.util.Event.onDOMReady(function() {
			MTComments.HookBehavior();
		});
		</script>
<link type="text/css" rel="stylesheet" href="./JSAPI User Guide - MDN_files/SyntaxHighlighter.css"><script type="text/javascript" src="./JSAPI User Guide - MDN_files/shCore.js"></script><script type="text/javascript" src="./JSAPI User Guide - MDN_files/shBrushCpp.js"></script><script type="text/javascript" src="./JSAPI User Guide - MDN_files/rgbcolor.js"></script>
<script type="text/javascript" src="./JSAPI User Guide - MDN_files/nav.js"></script>

<script type="text/javascript">

Deki.BaseHref = 'https://developer.mozilla.org';
Deki.PageId = 8704;
Deki.PageTitle = 'En/SpiderMonkey/JSAPI User Guide';
Deki.PageLanguageCode = 'en';
Deki.FollowRedirects = 1;
Deki.PathTpl = '/skins/mdn';
Deki.PathSkin = '/skins/mdn/Transitional';
Deki.PathCommon = '/skins/common';
Deki.UserName = 'Anonymous';
Deki.Today = '1 Oct 2011';
Deki.UserIsAnonymous = true;
Deki.EditorConfigToken = 'd724f61d';
Deki.EditorStylesToken = '7cdeb639';
Deki.PageEditable = false;
</script>
<script type="text/javascript">aLt["commercial-required"] = 'Gather feedback on your content with <strong>community scoring</strong> - these ratings weight results in adaptive search. Through curation analytics, ratings are used to highlight pages in need of attention. <a href="http://www.mindtouch.com/redir/mindtouch-tcs/">Learn more on enabling these capabilities with MindTouch 2010.</a>';aLt["login-required"] = 'You must be <a href="/index.php?title=Special:Userlogin&returntotitle=En%2FSpiderMonkey%2FJSAPI+User+Guide">logged in</a> to perform that action';</script><link href="./JSAPI User Guide - MDN_files/custom_css.php" rel="stylesheet" type="text/css"> 
 
<script src="./JSAPI User Guide - MDN_files/ga.js"></script><style type="text/css">.dp-cpp .datatypes { color: #2E8B57; font-weight: bold; }</style></head>

<body id="docs" class="section-docs en ltr yui-skin-sam PageDW-EnSpiderMonkeyJSAPIUserGuide hasJS" role="document">
<!--[if lte IE 8]>
<noscript><div class="global-notice">
<p><strong>Warning:</strong> The Mozilla Developer Network website employs emerging web standards that may not be fully supported in some versions of MicroSoft Internet Explorer. You can improve your experience of this website by enabling JavaScript.</p>
</div></noscript>
<![endif]-->
<noscript>&lt;div class="noscript"&gt;This application requires Javascript to be enabled.&lt;/div&gt;</noscript>
<header id="masthead" role="banner">
  <div class="wrap">
  
    <div id="branding">
      <h1 id="logo"><a href="https://developer.mozilla.org/"><img src="./JSAPI User Guide - MDN_files/mdn-logo-compact.png" alt="Mozilla Developer Network" title="Mozilla Developer Network" width="148" height="46"></a></h1>
    </div>

    <form id="site-search" method="get" action="https://developer.mozilla.org/search">
      <p>
        <input type="text" role="search" placeholder="Search MDN" id="q" name="q">
        <noscript>&lt;button type="submit"&gt;Search&lt;/button&gt;</noscript>
      </p>
      
      <div id="site-search-gg"><div class="gsc-branding"><table cellspacing="0" cellpadding="0" class="gsc-branding"><tbody><tr><td class="gsc-branding-text"><div class="gsc-branding-text">powered by</div></td><td class="gsc-branding-img-noclear"><img src="./JSAPI User Guide - MDN_files/small-logo.png" class="gsc-branding-img-noclear"></td></tr></tbody></table></div></div>
    </form>

    <nav id="nav" role="menubar">
      <ul id="nav-main">
        <li id="nav-main-topics" class="menu"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#nav-sub-topics" aria-haspopup="true" class="toggle" title="Explore other parts of MDN">Topics</a>
          <ul id="nav-sub-topics" class="sub-menu" aria-hidden="true">
            <li id="nav-sub-web"><a href="https://developer.mozilla.org/web">Web</a></li>
            <li id="nav-sub-mobile"><a href="https://developer.mozilla.org/mobile">Mobile</a></li>
            <li id="nav-sub-addons"><a href="https://developer.mozilla.org/addons">Add-ons</a></li>
            <li id="nav-sub-mozilla"><a href="https://developer.mozilla.org/mozilla">Mozilla</a></li>
          </ul>
        </li>
        <li id="nav-main-docs" class="menu"><a href="https://developer.mozilla.org/docs" class="docs toggle" aria-haspopup="true" aria-labelledby="nav-main-docs">Docs</a>
          <div id="nav-sub-docs" class="sub-menu" aria-hidden="true">
            <ul>
              <li>
                <ul>
                  <li><a href="https://developer.mozilla.org/en/HTML">HTML</a></li>
                  <li><a href="https://developer.mozilla.org/en/DOM">DOM</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_audio_and_video_in_Firefox">Video</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_audio_and_video_in_Firefox">Audio</a></li>
                  <li><a href="https://developer.mozilla.org/en/SVG">SVG</a></li>
                  <li><a href="https://developer.mozilla.org/en/WebGL">WebGL</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li><a href="https://developer.mozilla.org/en/HTML/HTML5">HTML5</a></li>
                  <li><a href="https://developer.mozilla.org/en/WebSockets">WebSockets</a></li>
                  <li><a href="https://developer.mozilla.org/en/Offline_resources_in_Firefox">Offline Cache</a></li>
                  <li><a href="https://developer.mozilla.org/en/DOM/Storage">Local Storage</a></li>
                  <li><a href="https://developer.mozilla.org/en/IndexedDB">IndexedDB</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_files_from_web_applications">File API</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li><a href="https://developer.mozilla.org/en/CSS">CSS</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_gradients">Gradients</a></li>
                  <li><a href="https://developer.mozilla.org/en/CSS/Using_CSS_transforms">Transforms</a></li>
                  <li><a href="https://developer.mozilla.org/en/CSS/CSS_transitions">Transitions</a></li>
                  <li><a href="https://developer.mozilla.org/en/CSS/CSS_animations">Animations</a></li>
                  <li><a href="https://developer.mozilla.org/en/CSS/Media_queries">Media Queries</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li><a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a></li>
                  <li><a href="https://developer.mozilla.org/en/Ajax">Ajax</a></li>
                  <li><a href="https://developer.mozilla.org/en/HTML/Canvas">Canvas</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_geolocation">Geolocation</a></li>
                  <li><a href="https://developer.mozilla.org/en/DragDrop/Drag_and_Drop">Drag &amp; Drop</a></li>
                  <li><a href="https://developer.mozilla.org/en/Using_web_workers">Web Workers</a></li>
                </ul>
              </li>
            </ul>
            <p><a href="https://developer.mozilla.org/docs">More docs…</a></p>
          </div>
        </li>
        <li id="nav-main-demos"><a href="https://developer.mozilla.org/demos" class="demos">Demos</a></li>
        <li id="nav-main-learning"><a href="https://developer.mozilla.org/learn" class="learning">Learning</a></li>
        <li id="nav-main-community" class="menu"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#nav-sub-community" class="community toggle" aria-haspopup="true" aria-labelledby="nav-main-community">Community</a>
          <ul id="nav-sub-community" class="sub-menu" aria-hidden="true">
            <li><a href="https://developer.mozilla.org/events">Events</a></li>
            <li><a href="https://developer.mozilla.org/discussions">Discussions</a></li>
            <li><a href="https://developer.mozilla.org/promote">Promote</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    
      <ul class="user-state superfish">
              <li>	<a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&register=true" title="Join MDN">Join MDN</a>
</li>
        <li><a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&returntotitle=En%2FSpiderMonkey%2FJSAPI+User+Guide" class="user-login">Log in</a></li>
            </ul>

  </div>
</header>


<section id="nav-toolbar">
<div class="wrap">

<nav id="tool-menus">
  <ul id="tools" class="superfish">
    <li class="menu">
      <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#site-tools" class="toggle">Site tools</a>
      <ul id="site-tools" class="sub-menu" role="navigation" style="display: none; visibility: hidden; ">
         
        <li class="site-recent">	<a href="https://developer.mozilla.org/Special:Recentchanges" title="Recent changes">Recent changes</a>
</li>
        <li class="site-rss">	<a href="https://developer.mozilla.org/Special:ListRss" title="RSS feeds">RSS feeds</a>
</li>
      	<li class="siteListusers"><a href="https://developer.mozilla.org/User:" title="Users">Users</a></li>
              <li class="site-templates">	<a href="https://developer.mozilla.org/Template:" title="Templates">Templates</a>
</li>
              <li class="site-map">	<a href="https://developer.mozilla.org/Special:Sitemap" title="Sitemap">Sitemap</a>
</li>
        <li class="site-popular">	<a href="https://developer.mozilla.org/Special:Popularpages" title="Popular pages">Popular pages</a>
</li>
      	<li class="siteAbout"><a href="https://developer.mozilla.org/Special:About" title="About MDN">About MDN</a></li>
      </ul>
    </li>
    <li class="menu">
      <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#page-tools" class="toggle">This page</a>
      <ul id="page-tools" class="sub-menu" role="navigation" style="display: none; visibility: hidden; ">
                                <li class="page-new"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" title="New page" class="disabled ">New sub-page</a></li>
                    <li class="page-history"><a href="https://developer.mozilla.org/index.php?title=En/SpiderMonkey/JSAPI_User_Guide&action=history" title="Page history">History</a></li>
                    <li class="page-talk">	<a href="https://developer.mozilla.org/Talk:En/SpiderMonkey/JSAPI_User_Guide" title="Talk page">Talk page</a>
</li>
                                                        <li class="page-print">	<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" onclick="return window.print();" title="Print page">Print page</a>
</li>
            <li class="page-backlinks"><a href="https://developer.mozilla.org/index.php?title=Special:Article&type=backlinks&pageid=8704">Pages that link here</a></li>      </ul>
    </li>
      <li class="menu">
      <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" class="toggle">Languages</a>
      <ul style="display: none; visibility: hidden; "><li><a rel="internal" href="https://developer.mozilla.org/cn/JavaScript-C%E5%BC%95%E6%93%8E%E5%B5%8C%E5%85%A5%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97" title="cn/JavaScript-C引擎嵌入开发指南">中文 (中国)</a></li><li><a rel="internal" href="https://developer.mozilla.org/ja/Embedding_SpiderMonkey" title="ja/Embedding_SpiderMonkey">日本語</a></li></ul>    </li>
    </ul>
</nav>

  <nav class="crumbs" role="navigation">
    <ol>
      <li class="crumb-one"><a href="https://developer.mozilla.org/">MDN</a></li>
      <li class="crumb-two"><a href="https://developer.mozilla.org/docs">Docs</a></li>
    <li class="first"><a href="https://developer.mozilla.org/" class="deki-ns">MDN</a></li>
<li class="second"><a href="https://developer.mozilla.org/en" class="deki-ns">MDN</a></li>
<li><a href="https://developer.mozilla.org/en/SpiderMonkey" class="deki-ns">SpiderMonkey</a></li>
<li class="last"><a href="./JSAPI User Guide - MDN_files/JSAPI User Guide - MDN.html" class="deki-ns current">JSAPI User Guide</a></li> 
    </ol>
  </nav>

</div>
</section>

<section id="content">
<div class="wrap">
  <div id="content-main" class="full">

    <div id="sessionMsg"><div class="inner"><ul></ul></div></div>
        
    <article class="article PageDW-EnSpiderMonkeyJSAPIUserGuide" role="main">
            
            <div class="page-title hideforedit">
              <h1 class="first" id="title">JSAPI User Guide</h1>            
      
              <ul id="page-buttons">
          <li class="page-edit"><a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&returntotitle=En%2FSpiderMonkey%2FJSAPI+User+Guide" class="disabled" title="Log in or sign up to edit this page">Edit</a></li>
          <li class="page-watch"><a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&returntotitle=En%2FSpiderMonkey%2FJSAPI+User+Guide" class="disabled" title="Log in or sign up to add this page to your watch list">Watch</a></li>
        </ul> 
            </div>
      
    <div class="page-content boxed">

     
      <div id="article-nav" class="hideforedit">      
              <div class="page-toc">
          <h2>Table of contents</h2>
          <ol style="list-style-type:none; margin-left:0px; padding-left:0px;"><li><span>1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#What_SpiderMonkey_does" rel="internal">What SpiderMonkey does</a></li><li><span>2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Hello_world" rel="internal">Hello world</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>2.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Using_the_SpiderMonkey_library" rel="internal">Using the SpiderMonkey library</a></li><li><span>2.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#The_SpiderMonkey_universe" rel="internal">The SpiderMonkey universe</a></li><li><span>2.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#A_minimal_example" rel="internal">A minimal example</a></li><li><span>2.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Native_functions" rel="internal">Native functions</a></li></ol></li><li><span>3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JSAPI_Concepts" rel="internal">JSAPI Concepts</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JavaScript_values" rel="internal">JavaScript values</a></li><li><span>3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Garbage_collection" rel="internal">Garbage collection</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.2.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Keeping_objects_alive" rel="internal">Keeping objects alive</a></li><li><span>3.2.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#GC_performance" rel="internal">GC performance</a></li></ol></li><li><span>3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Errors_and_exceptions" rel="internal">Errors and exceptions</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Throwing_and_catching_exceptions" rel="internal">Throwing and catching exceptions</a></li><li><span>3.3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Error_reports" rel="internal">Error reports</a></li><li><span>3.3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Automatic_handling_of_uncaught_exceptions" rel="internal">Automatic handling of uncaught exceptions</a></li><li><span>3.3.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Uncatchable_errors" rel="internal">Uncatchable errors</a></li></ol></li></ol></li><li><span>4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#More_sample_code" rel="internal">More sample code</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>4.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Defining_objects_and_properties" rel="internal">Defining objects and properties</a></li><li><span>4.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Defining_classes" rel="internal">Defining classes</a></li><li><span>4.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Running_scripts" rel="internal">Running scripts</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>4.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Calling_functions" rel="internal">Calling functions</a></li></ol></li><li><span>4.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JSContext" rel="internal">JSContext</a></li><li><span>4.5.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Initializing_built-in_and_global_JS_objects" rel="internal">Initializing built-in and global JS objects</a></li><li><span>4.6.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Creating_and_initializing_custom_objects" rel="internal">Creating and initializing custom objects</a></li><li><span>4.7.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Creating_an_object_from_a_script" rel="internal">Creating an object from a script</a></li><li><span>4.8.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Custom_objects" rel="internal">Custom objects</a></li><li><span>4.9.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Providing_private_data_for_objects" rel="internal">Providing private data for objects</a></li></ol></li><li><span>5.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Special_topics" rel="internal">Special topics</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Unicode" rel="internal">Unicode</a></li><li><span>5.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Compiled_scripts" rel="internal">Compiled scripts</a></li><li><span>5.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Security" rel="internal">Security</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#The_best_security_is_no_security_(really)" rel="internal">The best security is no security (really)</a></li><li><span>5.3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Object-capabilities-based_security" rel="internal">Object-capabilities-based security</a></li><li><span>5.3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Fine-grained_security" rel="internal">Fine-grained security</a></li></ol></li><li><span>5.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Tracing_and_Profiling" rel="internal">Tracing and Profiling</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.4.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Function_tracing" rel="internal">Function tracing</a></li></ol></li></ol></li></ol>        </div>
      
        <ul class="page-anchors">
          <li class="anchor-tags"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#page-tags" title="Jump to tags for this article">Tags</a></li>
          <li class="anchor-files"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#page-files" title="Jump to files for this article">Files</a></li>
        </ul>

              <div id="deki-page-alerts" class="disabled">
				<div class="toggle">
					<a href="javascript:void(0);" class="off">
						<span>Page Notifications</span>
						<span class="status">Off</span>
					</a>
				</div></div>      
      
      </div> 
    
            
      <div id="page-top"><div id="pageToc"><div class="pageToc"><h5>Table of contents</h5><ol style="list-style-type:none; margin-left:0px; padding-left:0px;"><li><span>1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#What_SpiderMonkey_does" rel="internal">What SpiderMonkey does</a></li><li><span>2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Hello_world" rel="internal">Hello world</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>2.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Using_the_SpiderMonkey_library" rel="internal">Using the SpiderMonkey library</a></li><li><span>2.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#The_SpiderMonkey_universe" rel="internal">The SpiderMonkey universe</a></li><li><span>2.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#A_minimal_example" rel="internal">A minimal example</a></li><li><span>2.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Native_functions" rel="internal">Native functions</a></li></ol></li><li><span>3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JSAPI_Concepts" rel="internal">JSAPI Concepts</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JavaScript_values" rel="internal">JavaScript values</a></li><li><span>3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Garbage_collection" rel="internal">Garbage collection</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.2.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Keeping_objects_alive" rel="internal">Keeping objects alive</a></li><li><span>3.2.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#GC_performance" rel="internal">GC performance</a></li></ol></li><li><span>3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Errors_and_exceptions" rel="internal">Errors and exceptions</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>3.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Throwing_and_catching_exceptions" rel="internal">Throwing and catching exceptions</a></li><li><span>3.3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Error_reports" rel="internal">Error reports</a></li><li><span>3.3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Automatic_handling_of_uncaught_exceptions" rel="internal">Automatic handling of uncaught exceptions</a></li><li><span>3.3.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Uncatchable_errors" rel="internal">Uncatchable errors</a></li></ol></li></ol></li><li><span>4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#More_sample_code" rel="internal">More sample code</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>4.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Defining_objects_and_properties" rel="internal">Defining objects and properties</a></li><li><span>4.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Defining_classes" rel="internal">Defining classes</a></li><li><span>4.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Running_scripts" rel="internal">Running scripts</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>4.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Calling_functions" rel="internal">Calling functions</a></li></ol></li><li><span>4.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#JSContext" rel="internal">JSContext</a></li><li><span>4.5.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Initializing_built-in_and_global_JS_objects" rel="internal">Initializing built-in and global JS objects</a></li><li><span>4.6.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Creating_and_initializing_custom_objects" rel="internal">Creating and initializing custom objects</a></li><li><span>4.7.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Creating_an_object_from_a_script" rel="internal">Creating an object from a script</a></li><li><span>4.8.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Custom_objects" rel="internal">Custom objects</a></li><li><span>4.9.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Providing_private_data_for_objects" rel="internal">Providing private data for objects</a></li></ol></li><li><span>5.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Special_topics" rel="internal">Special topics</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Unicode" rel="internal">Unicode</a></li><li><span>5.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Compiled_scripts" rel="internal">Compiled scripts</a></li><li><span>5.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Security" rel="internal">Security</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.3.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#The_best_security_is_no_security_(really)" rel="internal">The best security is no security (really)</a></li><li><span>5.3.2.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Object-capabilities-based_security" rel="internal">Object-capabilities-based security</a></li><li><span>5.3.3.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Fine-grained_security" rel="internal">Fine-grained security</a></li></ol></li><li><span>5.4.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Tracing_and_Profiling" rel="internal">Tracing and Profiling</a><ol style="list-style-type:none; margin-left:0px; padding-left:15px;"><li><span>5.4.1.</span> <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Function_tracing" rel="internal">Function tracing</a></li></ol></li></ol></li></ol></div></div><div class="pageText" id="pageText">
<p>This document explains how to embed <a title="en/SpiderMonkey" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a>, the Mozilla JavaScript engine, in your C/C++ program.</p>
<p>JavaScript is widely used for client-side scripts that run in the browser. But Mozilla's JavaScript engine is a library that can be linked into any C/C++ program, not just a browser. Many applications can benefit from scripting. These programs can execute JavaScript code from C using the SpiderMonkey API.</p>
<div class="note"><strong>Note:</strong> The <a title="En/SpiderMonkey/FOSS" class="internal" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/FOSS">FOSS</a> wiki page contains a few links to other libraries and programs that can make life easier when using Spidermonkey and JSAPI.</div>
<div id="section_1"><span id="What_SpiderMonkey_does"></span><h2 class="editable">What SpiderMonkey does</h2>
<p>The JavaScript engine compiles and executes scripts containing JavaScript statements and functions. The engine handles memory allocation for the objects needed to execute scripts, and it cleans up—garbage collects—objects it no longer needs.</p>
<p>SpiderMonkey supports versions 1.0 through 1.8 of the JavaScript language. JS 1.3 and later conform to the ECMAScript specification, ECMA 262-3. Later versions also contain Mozilla extensions such as array comprehensions and generators. SpiderMonkey also supports <a title="en/E4X" rel="internal" href="https://developer.mozilla.org/en/E4X">E4X</a> (optionally).</p>
<p>The word <em>JavaScript</em> may bring to mind features such as event handlers (like <code><a title="en/DOM/element.onclick" rel="internal" href="https://developer.mozilla.org/en/DOM/element.onclick">onclick</a></code>), <a title="en/DOM" rel="internal" href="https://developer.mozilla.org/en/DOM">DOM</a> objects, <code><a title="en/DOM/window.open" rel="internal" href="https://developer.mozilla.org/en/DOM/window.open">window.open</a></code>, and <code><a title="en/XMLHttpRequest" rel="internal" href="https://developer.mozilla.org/En/XMLHttpRequest">XMLHttpRequest</a></code>. But in Mozilla, all of these features are actually provided by other components, not the SpiderMonkey engine itself. SpiderMonkey provides a few core JavaScript data types—numbers, strings, <code>Array</code>s, <code>Object</code>s, and so on—and a few methods, such as <code>Array.push</code>. It also makes it easy for each application to expose some of its own objects and functions to JavaScript code. Browsers expose DOM objects. Your application will expose objects that are relevant for the kind of scripts you want to write. It is up to the application developer to decide what objects and methods are exposed to scripts.</p>
</div><div id="section_2"><span id="Hello_world"></span><h2 class="editable">Hello world</h2>
<div id="section_3"><span id="Using_the_SpiderMonkey_library"></span><h3 class="editable">Using the SpiderMonkey library</h3>
<p>Your application can use SpiderMonkey like any other C/C++ library. To build SpiderMonkey from source, see <a title="en/SpiderMonkey_Build_Documentation" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/Build_Documentation">SpiderMonkey Build Documentation</a>. You can build SpiderMonkey as a static library or as a shared library.</p>
<p>Some platforms (such as Debian Linux) provide SpiderMonkey as a prebuilt package; this can be easier to install but harder to debug.</p>
<p>C/C++ code accesses SpiderMonkey via the JSAPI, by including the header <code>"jsapi.h"</code>. The JSAPI provides functions for setting up the JavaScript runtime, compiling and executing scripts, creating and examining JavaScript data structures, handling errors, enabling security checks, and debugging scripts.</p>
<p>An overview of JSAPI functionality follows. For more details, see the <a title="en/JSAPI_Reference" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference">JSAPI Reference</a>.</p>
</div><div id="section_4"><span id="The_SpiderMonkey_universe"></span><h3 class="editable">The SpiderMonkey universe</h3>
<p>In order to run any JavaScript code in SpiderMonkey, an application must have three key elements: a <code>JSRuntime</code>, a <code>JSContext</code>, and a global object. This section describes what these things are. The next section explains how to set them up, using JSAPI functions.</p>
<p><strong>Runtimes.</strong> A <code>JSRuntime</code>, or <em>runtime</em>, is the space in which the JavaScript variables, objects, scripts, and contexts used by your application are allocated. Every <code>JSContext</code> and every object in an application lives within a <code>JSRuntime</code>. They cannot travel to other runtimes or be shared across runtimes. Most applications only need one runtime.</p>
<p><strong>Contexts.</strong> A <code>JSContext</code>, or <em>context</em>, is like a little machine that can do many things involving JavaScript code and objects. It can compile and execute scripts, get and set object properties, call JavaScript functions, convert JavaScript data from one type to another, create objects, and so on. Almost all JSAPI functions require a <code>JSContext&nbsp;*</code> as the first argument, just like most <code>&lt;stdio.h&gt;</code> functions require a <code>FILE&nbsp;*</code>.</p>
<p>There is a close association between contexts and threads. Simple, single-threaded applications can use a single context for everything. But each context can only do one thing at a time, so in a multithreaded application, only one thread at a time should use any given context. Such an application typically has one context per thread. JavaScript objects, on the other hand, are <em>not</em> permanently associated with the script, thread, or context that created them. They can be shared among many scripts or even many threads, as shown in the figure below.</p>
<p>Figure 1.1 illustrates the relationship of scripts to the runtime, contexts, and objects.</p>
<div style="margin-left: 3em;">
<p><strong><small>Figure 1.1</small></strong></p>
<p><img alt="Image:Over3.gif" class="internal" src="./JSAPI User Guide - MDN_files/=Over3.gif"></p>
</div>
<p><strong>Global objects.</strong> Lastly, the <em>global object</em> contains all the classes, functions, and variables that are available for JavaScript code to use. Whenever JavaScript code does something like <code>window.open("http://www.mozilla.org/")</code>, it is accessing a global property, in this case <code>window</code>. JSAPI applications have full control over what global properties scripts can see. The application starts out by creating an object and populating it with the standard JavaScript classes, like <code>Array</code> and <code>Object</code>. Then it adds whatever custom classes, functions, and variables (like <code>window</code>) the application wants to provide; see <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#Custom_objects">Custom objects</a> below. Each time the application runs a JS script (using, for example, <code><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateScript</a></code>), it provides the global object for that script to use. As the script runs, it can create global functions and variables of its own. All of these functions, classes, and variables are stored as properties of the global object.</p>
</div><div id="section_5"><span id="A_minimal_example"></span><h3 class="editable">A minimal example</h3>
<p>Each of the three key elements described in the previous section requires a few JSAPI calls:</p>
<ul> <li> <p>The runtime: Use <code><a title="en/JS_NewRuntime" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewRuntime">JS_NewRuntime</a></code> to create it and <code><a title="en/JS_DestroyRuntime" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DestroyRuntime">JS_DestroyRuntime</a></code> to clean it up when you're done. When your application is done with SpiderMonkey altogether, use <code><a title="en/JS_ShutDown" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ShutDown">JS_ShutDown</a></code> to free any remaining cached resources. (This is a mere nicety if the process is about to exit anyway. But as that is not always the case, calling <code>JS_Shutdown</code> is a good habit to get into.)</p> </li> <li> <p>The context: Use <code><a title="en/JS_NewContext" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewContext">JS_NewContext</a></code> and <code><a title="en/JS_DestroyContext" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DestroyContext">JS_DestroyContext</a></code>. For maximum ECMAScript standard compliance, applications should also use <code><a title="en/JS_SetOptions" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetOptions">JS_SetOptions</a></code> to enable <code><a title="en/JS_SetOptions" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetOptions">JSOPTION_VAROBJFIX</a></code>. To get the latest JavaScript language features, applications may use <code><a title="en/JS_SetVersion" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetVersion">JS_SetVersion</a></code>. Error reporting is also per-context and is enabled using <code><a title="en/JS_SetErrorReporter" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetErrorReporter">JS_SetErrorReporter</a></code>.</p> </li> <li> <p>The global object: To create this object, you first need a <code><a title="en/JSClass" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSClass">JSClass</a></code> with the <code><a title="en/JSClass.flags" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSClass.flags">JSCLASS_GLOBAL_FLAGS</a></code> option. The example below defines a very basic <code>JSClass</code> (named <code>global_class</code>) with no methods or properties of its own. Use <code><a title="en/SpiderMonkey/JSAPI_Reference/JS_NewGlobalObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewGlobalObject">JS_NewGlobalObject</a></code> to create a global object. Use <code><a title="en/JS_InitStandardClasses" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InitStandardClasses">JS_InitStandardClasses</a></code> to populate it with the standard JavaScript globals.</p> </li>
</ul>
<p>This may seem like a lot of pieces for a simple application. It amounts to about 50 lines of code, as shown below. But the JSAPI is designed to scale to applications that need many threads, many contexts, and many global objects. It is a fine-grained API, supporting many different combinations of the parts, and giving applications precise control over how SpiderMonkey behaves.</p>
<p>Here is the boilerplate code necessary for a minimal JSAPI application. It contains everything described above.</p>
<pre><div>/*</div><div>&nbsp;* This define is for Windows only, it is a work-around for bug 661663.</div><div>&nbsp;*/</div><div>#ifdef _MSC_VER</div><div># define XP_WIN</div><div>#endif</div>
#include "jsapi.h"

/* The class of the global object. */
static <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSClass">JSClass</a> global_class = {
    "global", <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSClass.flags">JSCLASS_GLOBAL_FLAGS</a>,
    JS_PropertyStub, JS_PropertyStub, JS_PropertyStub, JS_StrictPropertyStub,
    JS_EnumerateStub, JS_ResolveStub, JS_ConvertStub, JS_FinalizeStub,
    JSCLASS_NO_OPTIONAL_MEMBERS
};

/* The error reporter callback. */
void reportError(JSContext *cx, const char *message, <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSErrorReport">JSErrorReport</a> *report)
{
    fprintf(stderr, "%s:%u:%s\n",
            report-&gt;filename&nbsp;? report-&gt;filename&nbsp;: "&lt;no filename&gt;",
            (unsigned int) report-&gt;lineno,
            message);
}

int main(int argc, const char *argv[])
{
    /* JS variables. */
    JSRuntime *rt;
    JSContext *cx;
    JSObject  *global;

    /* Create a JS runtime. */
    rt = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_NewRuntime">JS_NewRuntime</a>(8L * 1024L * 1024L);
    if (rt == NULL)
        return 1;

    /* Create a context. */
    cx = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_NewContext">JS_NewContext</a>(rt, 8192);
    if (cx == NULL)
        return 1;
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_SetOptions">JS_SetOptions</a>(cx, JSOPTION_VAROBJFIX | JSOPTION_JIT&nbsp;| JSOPTION_METHODJIT);
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_SetVersion">JS_SetVersion</a>(cx, JSVERSION_LATEST);
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_SetErrorReporter">JS_SetErrorReporter</a>(cx, reportError);

    /* Create the global object in a new compartment. */
    global = <a title="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewCompartmentAndGlobalObject" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewCompartmentAndGlobalObject">JS_NewCompartmentAndGlobalObject</a>(cx, &amp;global_class,&nbsp;NULL);
    if (global == NULL)
        return 1;

    /* Populate the global object with the standard globals,
       like Object and Array. */
    if (!<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_InitStandardClasses">JS_InitStandardClasses</a>(cx, global))
        return 1;

    .
    .
    .

    /* Your application code here. This may include JSAPI calls
       to create your own custom JS objects and run scripts. */

    .
    .
    .

    /* Cleanup. */
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DestroyContext">JS_DestroyContext</a>(cx);
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DestroyRuntime">JS_DestroyRuntime</a>(rt);
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ShutDown">JS_ShutDown</a>();
    return 0;
}
</pre>
<p>A typical JSAPI application should also run garbage collection periodically. An application can do this by periodically calling <code><a title="en/JS_MaybeGC" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_MaybeGC">JS_MaybeGC</a></code>.</p>
<p>Multithreaded applications have additional basic requirements, including build requirements. See <code><a title="en/JS_THREADSAFE" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_THREADSAFE">JS_THREADSAFE</a></code>.</p>
</div><div id="section_6"><span id="Native_functions"></span><h3 class="editable">Native functions</h3>
<p>Much of the rest of this guide explains how to expose custom functionality to scripts. The simplest way to start is by exposing a global native function.</p>
<p>Native functions are implemented in C/C++ but can be called from JavaScript just like any other function. The native function's signature must match <a class="internal" title="En/JSNative" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSNative"><code>JSNative</code></a>.</p>
<pre>#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
#include "jsapi.h"

/* A simple JS wrapper for the rand() function, from the C standard library.
   This example shows how to return a number from a JSNative.
   This is nearly the simplest possible JSNative function. */
JSBool myjs_rand(JSContext *cx, uintN argc, jsval *vp)
{
    JS_SET_RVAL(cx, vp, DOUBLE_TO_JSVAL(rand()));
    return JS_TRUE;
}

/* A wrapper for the srand() function, from the C standard library.
   This example shows how to handle optional arguments. */
JSBool myjs_srand(JSContext *cx, uintN argc, jsval *vp)
{
    uint32 seed;

    if (!<a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ConvertArguments">JS_ConvertArguments</a>(cx, argc, JS_ARGV(cx, vp), "/u", &amp;seed))
        return JS_FALSE;

    /* If called with no arguments, use the current time as the seed. */
    if (argc == 0)
        seed = time(NULL);

    srand(seed);

    JS_SET_RVAL(cx, vp, <a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSVAL_VOID">JSVAL_VOID</a>);  /* return undefined */
    return JS_TRUE;
}

/* A wrapper for the system() function, from the C standard library.
   This example shows how to report errors. */
JSBool myjs_system(JSContext *cx, uintN argc, jsval *vp)
{
    const char *cmd;
    int rc;

    if (!<a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ConvertArguments">JS_ConvertArguments</a>(cx, argc, JS_ARGV(cx, vp), "s", &amp;cmd))
        return JS_FALSE;

    rc = system(cmd);
    if (rc != 0) {
        /* Throw a JavaScript exception. */
        <a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ReportError">JS_ReportError</a>(cx, "Command failed with exit code %d", rc);
        return JS_FALSE;
    }

    JS_SET_RVAL(cx, vp, <a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSVAL_VOID">JSVAL_VOID</a>);  /* return undefined */
    return JS_TRUE;
}
</pre>
<p>Each <code>JSNative</code> has the same signature, regardless of what arguments it expects to receive from JavaScript.</p>
<p>The JavaScript arguments to the function are given in <code>argc</code> and <code>vp</code>. <code>argc</code> tells how many actual arguments the caller passed, and <code>JS_ARGV(cx, vp)</code> returns an array of those arguments. The arguments do not have native C/C++ types like <code>int</code> and <code>float</code>; rather, they are <a title="en/jsval" class="internal" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/Jsval"><code>jsval</code></a>s, JavaScript values. The native function uses <a title="en/JS_ConvertArguments" class="internal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ConvertArguments"><code>JS_ConvertArguments</code></a> to convert the arguments to C/C++ types and store them in local variables. The native function uses <code>JS_SET_RVAL(cx, vp, val)</code> to store its JavaScript return value.</p>
<p>On success, a <code>JSNative</code> must call <a title="en/SpiderMonkey/JSAPI Reference/JS SET RVAL" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSFastNative"><code>JS_SET_RVAL</code></a> and return <code>JS_TRUE</code>. The value passed to <code>JS_SET_RVAL</code> is returned to the JavaScript caller.</p>
<p>On failure, a <code>JSNative</code> calls an error-reporting function, in this case <a class="internal" title="en/JS_ReportError" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportError"><code>JS_ReportError</code></a>, and returns <code>JS_FALSE</code>. This causes a JavaScript exception to be thrown. The caller can catch the exception using a JavaScript <code>try/catch</code> statement.</p>
<p>To make native functions callable from JavaScript, declare a table of <a class="internal" title="en/JSFunctionSpec" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSFunctionSpec"><code>JSFunctionSpec</code></a>s describing the functions. Then call <a class="internal" title="en/JS_DefineFunctions" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineFunctions"><code>JS_DefineFunctions</code></a>.</p>
<pre>static JSFunctionSpec myjs_global_functions[] = {
    <a class="internal" href="https://developer.mozilla.org/En/JS_FS">JS_FS</a>("rand",   myjs_rand,   0, 0),
    JS_FS("srand",  myjs_srand,  0, 0),
    JS_FS("system", myjs_system, 1, 0),
    <a class="internal" href="https://developer.mozilla.org/En/JS_FS_END">JS_FS_END</a>
};

    ...
    if (!<a class="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DefineFunctions">JS_DefineFunctions</a>(cx, global, myjs_global_functions))
        return JS_FALSE;
    ...
</pre>
<p>Once the functions are defined in <code>global</code>, any script that uses <code>global</code> as the global object can call them, just as any web page can call <code>alert</code>. In the environment we have created, the "hello world" script looks like this:</p>
<pre>system("echo hello world");
</pre>
</div></div><div id="section_7"><span id="JSAPI_Concepts"></span><h2 class="editable">JSAPI Concepts</h2>
<p>This section aims to fill in the major gaps in the picture of the JSAPI&nbsp;presented so far. To do anything useful with SpiderMonkey, you must read all three sections.</p>
<div id="section_8"><span id="Working_with_JS_Values"></span><span id="JavaScript_values"></span><h3 class="editable">JavaScript values</h3>
<p>Main article: <code><a title="en/jsval" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/Jsval">jsval</a></code></p>
<p>JavaScript is a dynamically typed language: variables and properties do not have a type that is fixed at compile time. How can a statically typed language, like C or C++, in which all variables have types, interact with JavaScript? The JSAPI provides a data type, <code><a title="en/jsval" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/Jsval">jsval</a></code>, which can contain JavaScript values of any type. A <code>jsval</code> can be a number, a string, a boolean value, a reference to an object (like an <code>Object</code>, <code>Array</code>, <code>Date</code>, or <code>Function</code>), or one of the special values <code>null</code> or <code>undefined</code>.</p>
<p>For integers and boolean values, a <code>jsval</code> contains the value itself. In other cases, the <code>jsval</code> is a pointer to an object, string, or number.</p>
<div class="warning">
<p><strong>Warning:</strong> Like C/C++ pointers, and unlike JavaScript <code>var</code>s, a <code>jsval</code> is <strong>not</strong> automatically initialized to a safe value, and <strong>can</strong> become a dangling pointer!</p>
<p>A dangling pointer is a pointer that used to point to a valid object, but no longer does because the object no longer exists. Using a dangling pointer can crash a C/C++ program (or worse). In the case of <code>jsval</code>, the JavaScript garbage collector recycles objects, strings, and numbers that don't appear to be in use, and a <code>jsval</code> by itself does not protect its referent from the garbage collector. See <em>Garbage collection</em> below for crucial information on how to use <code>jsval</code>s safely.</p>
</div>
<p>The JSAPI includes macros that test the JavaScript data type of a <code>jsval</code>. These are:</p>
<ul> <li><code><a title="en/JSVAL_IS_OBJECT" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_OBJECT">JSVAL_IS_OBJECT</a></code></li> <li><code><a title="en/JSVAL_IS_NUMBER" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_NUMBER">JSVAL_IS_NUMBER</a></code></li> <li><code><a title="en/JSVAL_IS_INT" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_INT">JSVAL_IS_INT</a></code></li> <li><code><a title="en/JSVAL_IS_DOUBLE" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_DOUBLE">JSVAL_IS_DOUBLE</a></code></li> <li><code><a title="en/JSVAL_IS_STRING" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_STRING">JSVAL_IS_STRING</a></code></li> <li><code><a title="en/JSVAL_IS_BOOLEAN" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_BOOLEAN">JSVAL_IS_BOOLEAN</a></code></li> <li><code><a title="en/JSVAL_IS_NULL" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_NULL">JSVAL_IS_NULL</a></code></li> <li><code><a title="en/JSVAL_IS_VOID" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_IS_VOID">JSVAL_IS_VOID</a></code></li>
</ul>
<p style="text-align: left;">If a <code>jsval</code> points to a <code><a title="en/JSObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSObject">JSObject</a></code>, <code><a title="en/jsdouble" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/jsdouble">jsdouble</a></code>, or <code><a title="en/JSString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSString">JSString</a></code>, you can cast the <code>jsval</code> to its underlying data type using <code><a title="en/JSVAL_TO_OBJECT" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_TO_OBJECT">JSVAL_TO_OBJECT</a></code>, <code><a title="en/JSVAL_TO_DOUBLE" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_TO_DOUBLE">JSVAL_TO_DOUBLE</a></code>, and <code><a title="en/JSVAL_TO_STRING" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSVAL_TO_STRING">JSVAL_TO_STRING</a></code>, respectively. This is useful in some cases where your application or a JSAPI function requires a variable or argument of a specific data type, rather than a <code>jsval</code>. Similarly, you can cast a <code>JSObject</code>, <code>jsdouble</code>, or <code>JSString</code> pointer to a <code>jsval</code> using <code><a title="en/OBJECT_TO_JSVAL" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/OBJECT_TO_JSVAL">OBJECT_TO_JSVAL</a></code>, <code><a title="en/DOUBLE_TO_JSVAL" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/DOUBLE_TO_JSVAL">DOUBLE_TO_JSVAL</a></code>, or <code><a title="en/STRING_TO_JSVAL" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/STRING_TO_JSVAL">STRING_TO_JSVAL</a></code>.</p>
</div><div id="section_9"><span id="Garbage_collection"></span><h3 class="editable">Garbage collection</h3>
<p>As it runs, JavaScript code implicitly allocates memory for objects, strings, variables, and so on.&nbsp; Garbage collection is the process by which the JavaScript engine detects when those pieces of memory are no longer reachable—that is, they could not possibly ever be used again—and reclaims the memory.</p>
<p>Garbage collection has two important consequences for JSAPI applications. First, the application must be very careful to ensure that any values it needs are GC-reachable. The garbage collector is rather eager about its job. Any object you leave lying around will be destroyed if you don't tell the JSAPI you're still using it. Second, the application should take steps to reduce the performance impact of garbage collection.</p>
<div id="section_10"><span id="Keeping_objects_alive"></span><h4 class="editable">Keeping objects alive</h4>
<p>If your JSAPI application crashes, it is likely due to a GC-related error. The application must ensure that the garbage collector can reach all the objects, numbers, and strings that are still being used. Otherwise, the GC will free the memory occupied by those values, leading to a probable crash the next time your program tries to use them.</p>
<p>There are many ways to ensure that a value is GC-reachable.</p>
<ul> <li>If you just need the value to remain reachable for the duration of a <code><a title="en/JSNative" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSNative">JSNative</a></code> call, store it in <code>*rval</code> or an element of the <code>argv</code> array. The values stored in those locations are always reachable. To get extra <code>argv</code> slots, use <code><a title="en/JSFunctionSpec" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSFunctionSpec">JSFunctionSpec</a>.extra</code>.</li>
</ul>
<ul> <li>If a custom object needs certain values to remain in memory, just store the values in <a title="en/JS_SetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetProperty">properties</a> of the object. As long as the object is reachable, its properties will remain reachable. If these values must not be accessible from JavaScript, use <a title="en/JS_GetReservedSlot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetReservedSlot">reserved slots</a> instead. Or store the values in <a title="en/JS_SetPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetPrivate">private data</a> and implement <code><a title="en/JSClass.mark" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSClass.mark">JSClass.mark</a></code>.</li>
</ul>
<ul> <li>If a function creates new objects, strings, or numbers, it can use <code><a title="en/JS_EnterLocalRootScope" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EnterLocalRootScope">JS_EnterLocalRootScope</a></code> and <code><a title="en/JS_LeaveLocalRootScope" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_LeaveLocalRootScope">JS_LeaveLocalRootScope</a></code> to keep those values alive for the duration of the function.</li>
</ul>
<ul> <li>To keep a value alive permanently, store it in a <a title="JS_AddRoot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AddRoot">GC root</a>.</li>
</ul>
<p>Still, GC bugs do occur. These two functions, both available only in <code>DEBUG</code> builds, are especially useful for debugging GC-related crashes:</p>
<ul> <li>Use <code><a title="en/JS_SetGCZeal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetGCZeal">JS_SetGCZeal</a></code> to enable extra garbage collection. GC zeal usually causes a GC-related crash to occur much sooner (closer to its cause) and more reliably. It's for development and debugging only, because the extra garbage collection makes JS very slow.</li>
</ul>
<ul> <li>Use <code><a title="en/JS_DumpHeap" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DumpHeap">JS_DumpHeap</a></code> to dump the SpiderMonkey heap or specific interesting parts of it.</li>
</ul>
<p>See <a title="en/SpiderMonkey_Garbage_Collection_Tips" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey_Garbage_Collection_Tips">SpiderMonkey Garbage Collection Tips</a> for more details.</p>
</div><div id="section_11"><span id="GC_performance"></span><h4 class="editable">GC performance</h4>
<p>Overly frequent garbage collection can be a performance issue. Some applications can reduce the frequency of garbage collection simply by increasing the initial size of the <code>JSRuntime</code>.</p>
<p>Perhaps the best technique is to perform garbage collection during idle time, when it is least likely to have any impact on the user. By default, the JavaScript engine performs garbage collection when it has no other choice except to grow the process. This means that garbage collection typically happens when memory-intensive code is running, perhaps the worst possible time. An application can trigger garbage collection at a more convenient time by calling <code><a title="en/JS_GC" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GC">JS_GC</a></code> or <code><a title="en/JS_MaybeGC" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_MaybeGC">JS_MaybeGC</a></code>. <code>JS_GC</code> forces garbage collection. <code>JS_MaybeGC</code> performs garbage collection only if it is likely to reclaim a worthwhile amount of memory.</p>
</div></div><div id="section_12"><span id="Errors_and_exceptions"></span><h3 class="editable">Errors and exceptions</h3>
<p>The importance of checking the return value of JSAPI functions, of course, goes without saying. Almost every JSAPI function that takes a <code><a title="en/SpiderMonkey/JSAPI Reference/JSRuntime" class="internal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSRuntime">JSContext</a> *</code> argument can fail. The system might run out of memory. There might be a syntax error in a script. Or a script might explicitly <code>throw</code> an exception.</p>
<p>The JavaScript language has exceptions, and C++ has exceptions, but they are not the same thing. SpiderMonkey does not use C++ exceptions for anything. JSAPI functions never throw C++&nbsp;exceptions, and when SpiderMonkey calls an application callback, the callback must not throw a C++&nbsp;exception.</p>
<div id="section_13"><span id="Throwing_and_catching_exceptions"></span><h4 class="editable">Throwing and catching exceptions</h4>
<p>We have already seen one example of how to throw an exception from a <code>JSNative</code> function. Simply call <a title="en/SpiderMonkey/JSAPI Reference/JS ReportError" class="internal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportError"><code>JS_ReportError</code></a>, with <code>printf</code>-style arguments, and return <code>JS_FALSE</code>.</p>
<pre>    rc = system(cmd);
    if (rc != 0) {
        /* Throw a JavaScript exception. */
        <a title="en/SpiderMonkey/JSAPI Reference/JS ReportError" class="internal" href="mks://localhost/en/SpiderMonkey/JSAPI_Reference/JS_ReportError">JS_ReportError</a>(cx, "Command failed with exit code %d", rc);
        return JS_FALSE;
    }
</pre>
<p>This is very much like the JavaScript statement <code>throw new Error("Command failed with exit code " + rc);</code>. Again, note that calling <code>JS_ReportError</code> does not cause a C++&nbsp;exception to be thrown. It only creates a new JavaScript Error object and stores it in the context as the current <dfn>pending exception</dfn>. The application must also return JS_FALSE.</p>
<p>Once the C/C++ function returns JS_FALSE, the JavaScript engine starts unwinding the JavaScript stack, looking for a <code>catch</code> or <code>finally</code> block to execute. But SpiderMonkey's stack unwinding never removes application's C/C++ functions from the stack. Instead, SpiderMonkey simply returns <code>JS_FALSE</code> or <code>NULL</code> to the application, which can then handle the error as it chooses—or just return <code>JS_FALSE</code> to let it propagate further up the stack.</p>
<p>Several more examples of throwing and catching exceptions can be found in the <a title="En/SpiderMonkey/JSAPI Phrasebook" class="internal" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Cookbook">JSAPI Phrasebook</a>.</p>
</div><div id="section_14"><span id="Error_reports"></span><h4 class="editable">Error reports</h4>
<p>TODO your custom errorreporter</p>
<p>TODO when errors are reported</p>
</div><div id="section_15"><span id="Automatic_handling_of_uncaught_exceptions"></span><h4 class="editable">Automatic handling of uncaught exceptions</h4>
<p>The <code>JS_Compile</code>*, <code>JS_Call</code>*, <code>JS_Execute</code>*, and <code>JS_Evaluate</code>* functions automatically pass exceptions to the error reporter in certain cases. Each of these functions checks, just before it returns, to see if an exception is pending in the current <code>JSContext</code>. If so, it then checks to see if there is any other JavaScript script or function on the stack in that <code>JSContext</code>. If so, then the exception might yet be caught, so SpiderMonkey does nothing and returns JS_FALSE, allowing the exception to propagate. But if nothing is on the JavaScript stack, then the uncaught exception is passed to the error reporter and the pending exception is cleared.</p>
<p>The basic consequence is that top-level application code can just set an error reporter and start calling JSAPI&nbsp;functions. It never has to explicitly handle uncaught exceptions; the error reporter is automatically called. An application can disable automatic uncaught-exception handling using the <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS
SetOptions" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetOptions"><code>JSOPTION_DONT_REPORT_UNCAUGHT</code></a> option, but it must then deal with uncaught exceptions explicitly by calling <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS IsExceptionPending" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_IsExceptionPending"><code>JS_IsExceptionPending</code></a>, <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS GetPendingException" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPendingException"><code>JS_GetPendingException</code></a>, <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS_ReportPendingException" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportPendingException"><code>JS_ReportPendingException</code></a>, and/or <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS ClearPendingException" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ClearPendingException"><code>JS_ClearPendingException</code></a> whenever a JSAPI&nbsp;function returns <code>JS_FALSE</code>&nbsp;or <code>NULL</code>.</p>
</div><div id="section_16"><span id="Uncatchable_errors"></span><h4 class="editable">Uncatchable errors</h4>
<p>Another way for a <code>JSNative</code> callback to report an error is like this:</p>
<pre>    if (p == NULL) {
        <a title="en/SpiderMonkey/JSAPI Reference/JS ReportOutOfMemory" class="internal" href="mks://localhost/en/SpiderMonkey/JSAPI_Reference/JS_ReportOutOfMemory">JS_ReportOutOfMemory</a>(cx);
        return JS_FALSE;
    }
</pre>
<p>This does something subtly different from what <code>JS_ReportError</code> does.</p>
<p>Most errors, including those raised by <code>JS_ReportError</code>, are represented as JavaScript exceptions and thus interact with the JavaScript exception-handling language features, <code>try</code>, <code>catch</code>, and <code>finally</code>. However, in some cases we do not want scripts to be able to <code>catch</code> an error; we want script execution to terminate right away. If the system runs out of memory in the middle of a script, we do not want <code>finally</code> blocks to execute, because almost anything a script does requires at least a little memory, and we have none. If a script has been running too long and we want to kill it, it's no good to throw an exception—the script could just <code>catch</code> it and keep going.</p>
<p>Therefore <code><a title="en/SpiderMonkey/JSAPI Reference/JS ReportOutOfMemory" class="internal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportOutOfMemory">JS_ReportOutOfMemory</a>(cx)</code> does <em>not</em> set the pending exception. It is an uncatchable error.</p>
<p>If SpiderMonkey runs out of memory, or a JSAPI callback returns <code>JS_FALSE</code> without an exception pending, this is treated as an uncatchable error. The JavaScript stack is unwound in the normal way except that <code>catch</code> and <code>finally</code> blocks are ignored. The most recent JSAPI call returns <code>JS_FALSE</code> or <code>NULL</code> to the application.</p>
<p>An uncatchable error leaves the <code>JSContext</code> in a good state. It can be used again right away. The application does not have to do anything to “recover” from the error, as far as the JSAPI is concerned. (Of course, if the error is that the system is out of memory, that problem remains to be dealt with.)</p>
<p>Here is some example code that throws an uncatchable error.</p>
<pre>    /* Call the error reporter, if any. This part is optional. */
    <a title="en/SpiderMonkey/JSAPI Reference/JS ReportError" class="internal" href="mks://localhost/en/SpiderMonkey/JSAPI_Reference/JS_ReportError">JS_ReportError</a>(cx, "The server room is on fire!");
    JS_ReportPendingException(cx);

    /* Make sure the error is uncatchable. */
    <a title="en/SpiderMonkey/JSAPI Reference/JS ClearPendingException" class="internal" href="mks://localhost/en/SpiderMonkey/JSAPI_Reference/JS_ClearPendingException">JS_ClearPendingException</a>(cx);
    return JS_FALSE;
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div></div></div><div id="section_17"><span id="More sample code"></span><span id="More_sample_code"></span><h2 class="editable">More sample code</h2>
<p>The following examples illustrate how to achieve a few different effects using the JSAPI.</p>
<p>Note that the most important example is in the "A minimal example" section above. More JSAPI code samples appear in the <a title="en/JSAPI_Phrasebook" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Cookbook">JSAPI Phrasebook</a>.</p>
<div id="section_18"><span id="Defining_objects_and_properties"></span><h3 class="editable">Defining objects and properties</h3>
<pre>/* Statically initialize a class to make "one-off" objects. */
<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSClass">JSClass</a> my_class = {
    "MyClass",

    /* All of these can be replaced with the corresponding JS_*Stub
       function pointers. */
    my_addProperty, my_delProperty, my_getProperty, my_setProperty,
    my_enumerate,   my_resolve,     my_convert,     my_finalize
};

<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSObject">JSObject</a> *obj;

/*
 * Define an object named in the global scope that can be enumerated by
 * for/in loops.  The parent object is passed as the second argument, as
 * with all other API calls that take an object/name pair.  The prototype
 * passed in is null, so the default object prototype will be used.
 */
obj = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DefineObject">JS_DefineObject</a>(cx, globalObj, "myObject", &amp;my_class, NULL,
                      <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_GetPropertyAttributes">JSPROP_ENUMERATE</a>);

/*
 * Define a bunch of properties with a JSPropertySpec array statically
 * initialized and terminated with a null-name entry.  Besides its name,
 * each property has a "tiny" identifier (MY_COLOR, e.g.) that can be used
 * in switch statements (in a common my_getProperty function, for example).
 */
enum my_tinyid {
    MY_COLOR, MY_HEIGHT, MY_WIDTH, MY_FUNNY, MY_ARRAY, MY_RDONLY
};

static <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSPropertySpec">JSPropertySpec</a> my_props[] = {
    {"color",       MY_COLOR,       JSPROP_ENUMERATE},
    {"height",      MY_HEIGHT,      JSPROP_ENUMERATE},
    {"width",       MY_WIDTH,       JSPROP_ENUMERATE},
    {"funny",       MY_FUNNY,       JSPROP_ENUMERATE},
    {"array",       MY_ARRAY,       JSPROP_ENUMERATE},
    {"rdonly",      MY_RDONLY,      JSPROP_READONLY},
    {0}
};

<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DefineProperties">JS_DefineProperties</a>(cx, obj, my_props);

/*
 * Given the above definitions and call to JS_DefineProperties, obj will
 * need this sort of "getter" method in its class (my_class, above).  See
 * the example for the "It" class in js.c.
 */
static JSBool
my_getProperty(JSContext *cx, JSObject *obj, jsval id, jsval *vp)
{
    if (<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSVAL_IS_INT">JSVAL_IS_INT</a>(id)) {
        switch (<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSVAL_TO_INT">JSVAL_TO_INT</a>(id)) {
          case MY_COLOR:  *vp = . . .; break;
          case MY_HEIGHT: *vp = . . .; break;
          case MY_WIDTH:  *vp = . . .; break;
          case MY_FUNNY:  *vp = . . .; break;
          case MY_ARRAY:  *vp = . . .; break;
          case MY_RDONLY: *vp = . . .; break;
        }
    }
    return JS_TRUE;
}
</pre>
</div><div id="section_19"><span id="Defining_classes"></span><h3 class="editable">Defining classes</h3>
<p>This pulls together the above API elements by defining a constructor function, a prototype object, and properties of the prototype and of the constructor, all with one API call.</p>
<p>Initialize a class by defining its constructor function, prototype, and per-instance and per-class properties. The latter are called "static" below by analogy to Java. They are defined in the constructor object's scope, so that <code>MyClass.myStaticProp</code> works along with <code>new MyClass()</code>.</p>
<p><code><a title="en/JS_InitClass" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InitClass">JS_InitClass</a></code> takes a lot of arguments, but you can pass <code>NULL</code> for any of the last four if there are no such properties or methods.</p>
<p>Note that you do not need to call <code>JS_InitClass</code> to make a new instance of that class—otherwise there would be a chicken-and-egg problem making the global object—but you should call <code>JS_InitClass</code> if you require a constructor function for script authors to call via <code>new</code>, and/or a class prototype object (<code>MyClass.prototype</code>) for authors to extend with new properties at run time. In general, if you want to support multiple instances that share behavior, use <code>JS_InitClass</code>.</p>
<pre>protoObj = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_InitClass">JS_InitClass</a>(cx, globalObj, NULL, &amp;my_class,

                        /* native constructor function and min arg count */
                        MyClass, 0,

                        /* prototype object properties and methods -- these
                           will be "inherited" by all instances through
                           delegation up the instance's prototype link. */
                        my_props, my_methods,

                        /* class constructor properties and methods */
                        my_static_props, my_static_methods);
</pre>
</div><div id="section_20"><span id="Running_scripts"></span><h3 class="editable">Running scripts</h3>
<pre>/* These should indicate source location for diagnostics. */
char *filename;
uintN lineno;

/*
 * The return value comes back here -- if it could be a GC thing, you must
 * add it to the GC's "root set" with <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_AddRoot">JS_AddRoot</a>(cx, &amp;thing) where thing
 * is a JSString *, JSObject *, or jsdouble *, and remove the root before
 * rval goes out of scope, or when rval is no longer needed.
 */
jsval rval;
JSBool ok;

/*
 * Some example source in a C string.  Larger, non-null-terminated buffers
 * can be used, if you pass the buffer length to JS_EvaluateScript.
 */
char *source = "x * f(y)";

ok = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateScript</a>(cx, globalObj, source, strlen(source),
                       filename, lineno, &amp;rval);

if (ok) {
    /* Should get a number back from the example source. */
    jsdouble d;

    ok = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ValueToNumber">JS_ValueToNumber</a>(cx, rval, &amp;d);
    . . .
}
</pre>
<div id="section_21"><span id="Calling_functions"></span><h4 class="editable">Calling functions</h4>
<pre>/* Call a global function named "foo" that takes no arguments. */
ok = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_CallFunctionName">JS_CallFunctionName</a>(cx, globalObj, "foo", 0, 0, &amp;rval);

jsval argv[2];

/* Call a function in obj's scope named "method", passing two arguments. */
argv[0] = . . .;
argv[1] = . . .;
ok = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_CallFunctionName">JS_CallFunctionName</a>(cx, obj, "method", 2, argv, &amp;rval);
</pre>
</div></div><div id="section_22"><span id="JSContext"></span><h3 class="editable">JSContext</h3>
<p>Because there is a certain amount of overhead associated with allocating and maintaining contexts, a JSAPI application should:</p>
<ol> <li>Create only as many contexts as it needs at one time.</li> <li>Keep contexts for as long as they may be needed, rather than destroying and recreating them as needed.</li>
</ol>
<p>If your application creates multiple runtimes, the application may need to know which runtime a context is associated with. In this case, use <code><a title="en/JS_GetRuntime" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetRuntime">JS_GetRuntime</a></code>.</p>
<p>Use <code><a title="en/JS_GetContextPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetContextPrivate">JS_SetContextPrivate</a></code> and <code><a title="en/JS_GetContextPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetContextPrivate">JS_GetContextPrivate</a></code> to associate application-specific data with a context.</p>
</div><div id="section_23"><span id="Initializing_built-in_and_global_JS_objects"></span><h3 class="editable">Initializing built-in and global JS objects</h3>
<p>For a complete list of built-in objects provided by SpiderMonkey, see <code><a title="en/JS_InitStandardClasses" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InitStandardClasses">JS_InitStandardClasses</a></code>.</p>
<p>The global object that an application provides to scripts largely determines what those scripts can do. For example, the Firefox browser uses its own global object, <code>window</code>. To change the global object for you application, call <code><a title="en/JS_SetGlobalObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetGlobalObject">JS_SetGlobalObject</a></code>.</p>
</div><div id="section_24"><span id="Creating_and_initializing_custom_objects"></span><h3 class="editable">Creating and initializing custom objects</h3>
<p>In addition to using the engine's built-in objects, you will create, initialize, and use your own JS objects. This is especially true if you are using the JS engine with scripts to automate your application. Custom JS objects can provide direct program services, or they can serve as interfaces to your program's services. For example, a custom JS object that provides direct service might be one that handles all of an application's network access, or might serve as an intermediary broker of database services. Or a JS object that mirrors data and functions that already exist in the application may provide an object-oriented interface to C code that is not otherwise, strictly-speaking, object-oriented itself. Such a custom object acts as an interface to the application itself, passing values from the application to the user, and receiving and processing user input before returning it to the application. Such an object might also be used to provide access control to the underlying functions of the application.</p>
<p>There are two ways to create custom objects that the JS engine can use:</p>
<ul> <li>Write a JS script that creates an object, its properties, methods, and constructor, and then pass the script to the JS engine at run time.</li> <li>Embed code in your application that defines the object's properties and methods, call the engine to initialize a new object, and then set the object's properties through additional engine calls. An advantage of this method is that your application can contain native methods that directly manipulate the object embedding.</li>
</ul>
<p>In either case, if you create an object and then want it to persist in the run time where it can be used by other scripts, you must root the object by calling <code><a title="en/JS_AddRoot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AddRoot">JS_AddRoot</a></code> or <code><a title="en/JS_AddRoot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AddRoot">JS_AddNamedRoot</a></code>. Using these functions ensures that the JS engine will keep track of the objects and clean them up during garbage collection, if appropriate.</p>
</div><div id="section_25"><span id="Creating_an_object_from_a_script"></span><h3 class="editable">Creating an object from a script</h3>
<p>One reason to create a custom JS object from a script is when you only need an object to exist as long as the script that uses it is executing. To create objects that persist across script calls, you can embed the object code in your application instead of using a script.</p>
<p><strong>Note</strong>: You can also use scripts to create persistent objects, too.</p>
<p>To create a custom object using a script:</p>
<ol> <li>Define and spec the object. What is it intended to do? What are its data members (properties)? What are its methods (functions)? Does it require a run time constructor function?</li> <li>Code the JS script that defines and creates the object. For example: function myfun(){ var x = newObject(); . . . } <strong>NOTE</strong>: Object scripting using JavaScript occurs outside the context of embedding the JS engine in your applications. For more information about object scripting, see the <em>Client-Side JavaScript Guide</em> and the <em>Server-Side JavaScript Guide</em>. Embed the appropriate JS engine call(s) in your application to compile and execute the script. You have two choices: 1.) compile and execute a script with a single call to <code><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateScript</a></code>, <code><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateUCScript</a></code> or 2.) compile the script once with a call to <code><a title="en/JS_CompileScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScript">JS_CompileScript</a></code> or <code><a title="en/JS_CompileScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScript">JS_CompileUCScript</a></code>, and then execute it repeatedly with individual calls to <code><a title="en/JS_ExecuteScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ExecuteScript">JS_ExecuteScript</a></code>. The "UC" versions of these calls provide support for Unicode-encoded scripts.</li>
</ol>
<p>An object you create using a script only can be made available only during the lifetime of the script, or can be created to persist after the script completes execution. Ordinarily, once script execution is complete, its objects are destroyed. In many cases, this behavior is just what your application needs. In other cases, however, you will want object persistence across scripts, or for the lifetime of your application. In these cases you need to embed object creation code directly in your application, or you need to tie the object directly to the global object so that it persists as long as the global object itself persists.</p>
</div><div id="section_26"><span id="Custom_objects"></span><h3 class="editable">Custom objects</h3>
<p>An application can create a custom object without bothering with a <code>JSClass</code>:</p>
<ol> <li>Implement the getters, setters, and methods for your custom object in C or C++.&nbsp; Write a <a title="en/JSPropertyOp" class="internal" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSPropertyOp"><code>JSPropertyOp</code></a> for each getter or setter.&nbsp; Write a <a title="En/JSNative" class="internal" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSNative"><code>JSNative</code></a> or <code>JSFastNative</code> for each method.</li> <li>Declare a <code><a title="en/JSPropertySpec" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSPropertySpec">JSPropertySpec</a></code> array containing information about your custom object's properties, including getters and setters.</li> <li>Declare a <code><a title="en/JSFunctionSpec" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSFunctionSpec">JSFunctionSpec</a></code> array containing information about your custom object's methods.</li> <li>Call <code><a title="en/JS_NewObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewObject">JS_NewObject</a></code>, <code><a title="en/JS_ConstructObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ConstructObject">JS_ConstructObject</a></code>, or <code><a title="en/JS_DefineObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineObject">JS_DefineObject</a></code> to create the object.</li> <li>Call <code><a title="en/JS_DefineProperties" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineProperties">JS_DefineProperties</a></code> to define the object's properties.</li> <li>Call <code><a title="en/JS_DefineFunctions" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineFunctions">JS_DefineFunctions</a></code> to define the object's methods.</li>
</ol>
<p><code><a title="en/JS_SetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetProperty">JS_SetProperty</a></code> can also be used to create properties on an object. The properties it creates do not have getters or setters; they are ordinary JavaScript properties.</p>
</div><div id="section_27"><span id="Providing_private_data_for_objects"></span><h3 class="editable">Providing private data for objects</h3>
<p>Like contexts, you can associate large quantities of data with an object without having to store the data in the object itself. Call <code><a title="en/JS_SetPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetPrivate">JS_SetPrivate</a></code> to establish a pointer to private data for the object, and call <code><a title="en/JS_GetPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPrivate">JS_GetPrivate</a></code> to retrieve the pointer so that you can access the data. Your application is responsible for creating and managing this optional private data.</p>
<p>To create private data and associate it with an object:</p>
<ol> <li>Establish the private data as you would a normal C void pointer variable.</li> <li>Call <code><a title="en/JS_SetPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetPrivate">JS_SetPrivate</a></code>, specify the object for which to establish private data, and specify the pointer to the data.</li>
</ol>
<p>For example:</p>
<pre> JS_SetPrivate(cx, obj, pdata);
</pre>
<p>To retrieve the data at a later time, call <code><a title="en/JS_GetPrivate" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPrivate">JS_GetPrivate</a></code>, and pass the object as an argument. This function returns the pointer to an object's private data:</p>
<pre> pdata = JS_GetPrivate(cx, obj);
</pre>
</div></div><div id="section_28"><span id="Special_topics"></span><h2 class="editable">Special topics</h2>
<div id="section_29"><span id="Handling_Unicode"></span><span id="Unicode"></span><h3 class="editable">Unicode</h3>
<p>To pass Unicode data between JavaScript and native code, represent the data in UTF-16 in memory. JavaScript strings, property names, and programs are all made up of <code>jschar</code>s, which are 16-bit unsigned integers.</p>
<p>Many JSAPI functions operate on null-terminated, 8-bit <code>char</code> strings. These functions convert their <code>char *</code> arguments to 16-bit strings by zero-extending each 8-bit <code>char</code> to 16 bits—unless <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS C STRINGS ARE UTF8" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_C_STRINGS_ARE_UTF8"><code>JS_C_STRINGS_ARE_UTF8</code></a> is defined or <a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS SetCStringsAreUTF8" rel="internal" href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_CStringsAreUTF8"><code>JS_SetCStringsAreUTF8</code></a> has been called, in which case each <code>char *</code> string is interpreted as UTF-8 Unicode text.</p>
<p>The JSAPI provides <code>jschar</code>-based versions of many API functions that operate on strings, object properties, and JavaScript code.</p>
<table class="fullwidth-table"> <thead> <tr> <th><code>char</code>-based function</th> <th><code>jschar</code>-based function</th> </tr> </thead> <tbody> <tr> <td colspan="2"><em>Unicode data</em></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS GetStringBytes" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetStringBytes">JS_GetStringBytes</a></td> <td><a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS GetStringChars" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetStringChars">JS_GetStringChars</a></td> </tr> <tr> <td><a title="en/JS_NewString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewString">JS_NewString</a></td> <td><a title="en/JS_NewString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewString">JS_NewUCString</a></td> </tr> <tr> <td><a title="en/JS_NewStringCopyN" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewStringCopyN">JS_NewStringCopyN</a></td> <td><a title="en/JS_NewStringCopyN" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewStringCopyN">JS_NewUCStringCopyN</a></td> </tr> <tr> <td><a title="en/JS_NewStringCopyZ" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewStringCopyZ">JS_NewStringCopyZ</a></td> <td><a title="en/JS_NewStringCopyZ" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewStringCopyZ">JS_NewUCStringCopyZ</a></td> </tr> <tr> <td><a title="en/JS_InternString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InternString">JS_InternString</a></td> <td><a title="en/JS_InternString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InternString">JS_InternUCString</a>, <a title="en/JS_InternString" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InternString">JS_InternUCStringN</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS ReportErrorNumber" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportErrorNumber">JS_ReportErrorNumber</a></td> <td><a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS ReportErrorNumberUC" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportErrorNumber">JS_ReportErrorNumberUC</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS ReportErrorNumber" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportErrorNumber">JS_ReportErrorFlagsAndNumber</a></td> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS ReportErrorNumber" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ReportErrorNumber">JS_ReportErrorFlagsAndNumberUC</a>&nbsp;</td> </tr> </tbody> <tbody> <tr> <td colspan="2"><em>Unicode property names</em></td> </tr> <tr> <td><a title="en/JS_DefineProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineProperty">JS_DefineProperty</a></td> <td><a title="en/JS_DefineProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineProperty">JS_DefineUCProperty</a></td> </tr> <tr> <td><a title="en/JS_DefinePropertyWithTinyId" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefinePropertyWithTinyId">JS_DefinePropertyWithTinyId</a></td> <td><a title="en/JS_DefinePropertyWithTinyId" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefinePropertyWithTinyId">JS_DefineUCPropertyWithTinyId</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS DefineFunction" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineFunction">JS_DefineFunction</a></td> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS DefineFunction" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DefineFunction">JS_DefineUCFunction</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS HasProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_HasProperty">JS_HasProperty</a></td> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS HasProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_HasProperty">JS_HasUCProperty</a></td> </tr> <tr> <td><a title="en/JS_LookupProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_LookupProperty">JS_LookupProperty</a></td> <td><a title="en/JS_LookupProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_LookupProperty">JS_LookupUCProperty</a></td> </tr> <tr> <td><a title="en/JS_GetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetProperty">JS_GetProperty</a></td> <td><a title="en/JS_GetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetProperty">JS_GetUCProperty</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS GetPropertyAttributes" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPropertyAttributes">JS_GetPropertyAttributes</a></td> <td><a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS GetUCPropertyAttributes" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPropertyAttributes">JS_GetUCPropertyAttributes</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS GetPropertyAttrsGetterAndSetter" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPropertyAttrsGetterAndSetter">JS_GetPropertyAttrsGetterAndSetter</a></td> <td><a class="internal" title="en/SpiderMonkey/JSAPI Reference/JS GetUCPropertyAttrsGetterAndSetter" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetPropertyAttrsGetterAndSetter">JS_GetUCPropertyAttrsGetterAndSetter</a></td> </tr> <tr> <td><a title="en/JS_SetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetProperty">JS_SetProperty</a></td> <td><a title="en/JS_SetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetProperty">JS_SetUCProperty</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS SetPropertyAttributes" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetPropertyAttributes">JS_SetPropertyAttributes</a></td> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS SetPropertyAttributes" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetPropertyAttributes">JS_SetUCPropertyAttributes</a></td> </tr> <tr> <td><a title="en/JS_DeleteProperty2" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DeleteProperty2">JS_DeleteProperty2</a></td> <td><a title="en/JS_DeleteProperty2" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DeleteProperty2">JS_DeleteUCProperty2</a></td> </tr> <tr> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS AlreadyHasOwnProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AlreadyHasOwnProperty">JS_AlreadyHasOwnProperty</a></td> <td><a class="internal" title="En/SpiderMonkey/JSAPI Reference/JS AlreadyHasOwnProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AlreadyHasOwnProperty">JS_AlreadyHasOwnUCProperty</a>&nbsp;</td> </tr> </tbody> <tbody> <tr> <td colspan="2"><em>Unicode JavaScript source</em></td> </tr> <tr> <td><a title="en/JS_CompileScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScript">JS_CompileScript</a></td> <td><a title="en/JS_CompileScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScript">JS_CompileUCScript</a></td> </tr> <tr> <td><a title="en/JS_CompileScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScriptForPrincipals">JS_CompileScriptForPrincipals</a></td> <td><a title="en/JS_CompileScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScriptForPrincipals">JS_CompileUCScriptForPrincipals</a></td> </tr> <tr> <td><a title="en/JS_CompileFunction" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunction">JS_CompileFunction</a></td> <td><a title="en/JS_CompileFunction" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunction">JS_CompileUCFunction</a></td> </tr> <tr> <td><a title="en/JS_CompileFunctionForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunctionForPrincipals">JS_CompileFunctionForPrincipals</a></td> <td><a title="en/JS_CompileFunctionForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunctionForPrincipals">JS_CompileUCFunctionForPrincipals</a></td> </tr> <tr> <td><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateScript</a></td> <td><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateUCScript</a></td> </tr> <tr> <td><a title="en/JS_EvaluateScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScriptForPrincipals">JS_EvaluateScriptForPrincipals</a></td> <td><a title="en/JS_EvaluateScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScriptForPrincipals">JS_EvaluateUCScriptForPrincipals</a></td> </tr> </tbody>
</table>
<p><code>jschar</code>-based functions work exactly like their <code>char</code>-based namesakes, except that where traditional functions take a <code>char *</code> argument, the Unicode versions take a <code>jschar *</code> argument, usually with a separate argument specifying the length of the string in <code>jschar</code>s.</p>
</div><div id="section_30"><span id="Compiled_scripts"></span><h3 class="editable">Compiled scripts</h3>
<p>The easiest way to run a script is to use <code><a title="en/JS_EvaluateScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScript">JS_EvaluateScript</a></code>, which compiles and executes the script in one go.</p>
<p>But sometimes an application needs to run a script many times. In this case, it may be faster to compile the script once and execute it multiple times.</p>
<p>The JSAPI provides a type, <code><a title="en/JSScript" rel="internal" href="https://developer.mozilla.org/en/JSScript">JSScript</a></code>, that represents a compiled script. The life cycle of a <code>JSScript</code> looks like this:</p>
<ul> <li>The application compiles some JavaScript code using <code><a title="en/JS_CompileScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScript">JS_CompileScript</a></code>, <code><a title="en/JS_CompileFile" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFile">JS_CompileFile</a></code>, or <code><a title="en/JS_CompileFileHandle" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFileHandle">JS_CompileFileHandle</a></code>. These functions return a pointer to a new <code>JSScript</code>.</li>
</ul>
<ul> <li>The application calls <code><a title="en/JS_ExecuteScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ExecuteScript">JS_ExecuteScript</a></code> (or <code><a title="en/JS_ExecuteScriptPart" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ExecuteScriptPart">JS_ExecuteScriptPart</a></code>) any number of times. It is safe to use a <code>JSScript</code> in multiple different contexts <span class="lang lang-en"><i>(and different global objects?)</i> 
</span>, but only within the <code>JSRuntime</code> and thread in which it was created.</li>
</ul>
<ul> <li>The application cleans up the compiled script by calling <code><a title="en/JS_DestroyScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_DestroyScript">JS_DestroyScript</a></code>.</li>
</ul>
<p><span class="lang lang-en">
</span></p><div class="warning" style="overflow:hidden; padding: 0.7em; min-height: 103px;"><img style="float: left;" alt="" src="./JSAPI User Guide - MDN_files/=Nuvola_apps_important.png">
<div style="margin-left: 130px; margin-top: 0.3em;"><strong>Warning:</strong> In <code>mozilla-central</code> trunk, this is currently subject to 
<a rel="external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=438633" class="external" title="RESOLVED FIXED - JSScript atoms shouldn&#39;t be subject to GC right away">
bug 438633</a>
, so it can crash. The workaround is to use <code>JS_NewScriptObject</code> as described below. —<a rel="internal" href="https://developer.mozilla.org/User:Jorend" title="User:Jorend">jorendorff</a> 10:02, 15 June 2008 (PDT)</div>
</div>
   <p></p>
<p>Here is some example code using a compiled script:</p>
<pre>/*
 * Compile a script and execute it repeatedly until an
 * error occurs.  (If this ever returns, it returns false.
 * If there's no error it just keeps going.)
 */
<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSBool">JSBool</a> compileAndRepeat(<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSRuntime">JSContext</a> *cx, const char *filename)
{
    <a href="https://developer.mozilla.org/En/JSScript">JSScript</a> *script;

    script = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_CompileFile">JS_CompileFile</a>(cx, <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_GetGlobalObject">JS_GetGlobalObject</a>(cx), filename);
    if (script == NULL)
        return JS_FALSE;   /* compilation error */

    for (;;) {
        jsval result;

        if (!<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ExecuteScript">JS_ExecuteScript</a>(cx, <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_GetGlobalObject">JS_GetGlobalObject</a>(cx), script, &amp;result))
            break;
        <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_MaybeGC">JS_MaybeGC</a>(cx);
    }

    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DestroyScript">JS_DestroyScript</a>(cx, script);
    return JS_FALSE;
}
</pre>
<p>Sometimes it is inconvenient for an application to manage the lifetime of each script. Failing to call <code>JS_DestroyScript</code> can lead to memory leaks, and calling it too soon can cause crashes.</p>
<p>An alternative is to tie the lifetime of the compiled script to the lifetime of a JavaScript object, and let the garbage collector destroy the script when it is no longer reachable. The JSAPI provides this feature via the <code><a title="en/JS_NewScriptObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewScriptObject">JS_NewScriptObject</a></code> function. The life cycle of a script using this feature is like this:</p>
<ul> <li>The application compiles some JavaScript code.</li>
</ul>
<ul> <li>To protect the compiled script from garbage collection, the application creates a <em>compiled script object</em> by calling <code><a title="en/JS_NewScriptObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewScriptObject">JS_NewScriptObject</a></code> and makes that object GC-reachable using <code><a title="en/JS_SetProperty" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetProperty">JS_SetProperty</a></code>, <code><a title="en/JS_GetReservedSlot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_GetReservedSlot">JS_SetReservedSlot</a></code>, <code><a title="en/JS_AddRoot" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_AddRoot">JS_AddRoot</a></code>, or some other function.</li>
</ul>
<ul> <li>The application executes the compiled script any number of times.</li>
</ul>
<ul> <li>As the application progresses, eventually it doesn't need the compiled script anymore, and the compiled script object becomes unreachable.</li>
</ul>
<ul> <li>The garbage collector then eventually collects the unreachable script and its components.</li>
</ul>
<p>Here is example code demonstrating the technique—but note that this case is not really complex enough to warrant the use of <code><a title="en/JS_NewScriptObject" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_NewScriptObject">JS_NewScriptObject</a></code>. The above example does the same thing more directly.</p>
<pre>/*
 * Compile a script and execute it repeatedly until an
 * error occurs.  (If this ever returns, it returns false.
 * If there's no error it just keeps going.)
 */
<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSBool">JSBool</a> compileAndRepeat(<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSRuntime">JSContext</a> *cx, const char *filename)
{
    <a href="https://developer.mozilla.org/En/JSScript">JSScript</a> *script;
    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JSObject">JSObject</a> *scriptObj;

    script = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_CompileFile">JS_CompileFile</a>(cx, <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_GetGlobalObject">JS_GetGlobalObject</a>(cx), filename);
    if (script == NULL)
        return JS_FALSE;   /* compilation error */

    scriptObj = <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_NewScriptObject">JS_NewScriptObject</a>(cx, script);
    if (scriptObj == NULL) {
        <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_DestroyScript">JS_DestroyScript</a>(cx, script);
        return JS_FALSE;
    }

    if (!<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_AddRoot">JS_AddNamedObjectRoot</a>(cx, &amp;scriptObj, "compileAndRepeat script object"))
        return JS_FALSE;

    for (;;) {
        jsval result;

        if (!<a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_ExecuteScript">JS_ExecuteScript</a>(cx, <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_GetGlobalObject">JS_GetGlobalObject</a>(cx), script, &amp;result))
            break;
        <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_MaybeGC">JS_MaybeGC</a>(cx);
    }

    <a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_Reference/JS_RemoveRoot">JS_RemoveObjectRoot</a>(cx, &amp;scriptObj);  /* scriptObj becomes unreachable
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and will eventually be collected. */
    return JS_FALSE;
}
</pre>
</div><div id="section_31"><span id="Security"></span><h3 class="editable">Security</h3>
<p>Many applications use SpiderMonkey to run untrusted code. In designing this kind of application, it's important to think through the security concerns ahead of time. Your application will need to do several things.</p>
<ul> <li><strong>Deploy security updates</strong> - Firefox automatically installs updates, so security fixes are deployed as soon as they are available. Unless you also regularly deploy SpiderMonkey security updates, a determined hacker could use publicly known bugs in the engine to attack your application. Note that the kind of attack we're talking about here is where a hacker uses JavaScript to attack the C++ code of the engine itself (or your embedding). The rest of the items in this list talk about security issues that arise within JavaScript itself, even if the engine is working properly.</li> <li><strong>Block simple denial-of-service attacks</strong> - A program like <code>while(true){}</code> should not hang your application. To stop execution of scripts that run too long, use <a title="en/SpiderMonkey/JSAPI Reference/JS SetOperationCallback" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetOperationCallback"><code>JS_SetOperationCallback</code></a>. Likewise, a function like <code>function f(){f();}</code> should not crash your application with a stack overflow. To block that, use <a title="en/SpiderMonkey/JSAPI Reference/JS SetNativeStackQuota" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetNativeStackQuota"><code>JS_SetNativeStackQuota</code></a>.</li> <li><strong>Control access to sensitive data</strong> - Your application might expose data to some scripts that other scripts should not be able to see. For example, you might let your customers write scripts that operate on their own data, but not other customers' data. These access rules must be enforced somehow.</li> <li><strong>Control access to dangerous functionality</strong> - Suppose your application has a method deleteUserAccount() which is meant to be used by administrators only. Obviously if untrusted code can use that method, you have a security problem.</li>
</ul>
<p>The first two problems are important but fairly straightforward and will not be discussed further here. The rest of this section tells how you can control scripts' access to data and functionality.</p>
<div id="section_32"><span id="The_best_security_is_no_security_(really)"></span><h4 class="editable">The best security is no security (really)</h4>
<p>Do you ever worry about your snake eating your mouse? No? If you don't have both a snake and a mouse, you don't have this problem.</p>
<p>Likewise, if your application doesn't have both untrusted users (snakes) and sensitive data or dangerous functionality that's exposed to JavaScript (mice), then you don't need to read any further. The functions and objects created by <a title="en/SpiderMonkey/JSAPI Reference/JS InitStandardClasses" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_InitStandardClasses"><code>JS_InitStandardClasses</code></a> are safe. They do not provide access to files, the network, or anything browser-related. The most sensitive information they expose to scripts is the current date and time.</p>
</div><div id="section_33"><span id="Object-capabilities-based_security"></span><h4 class="editable">Object-capabilities-based security</h4>
<p>One way to keep a snake from eating a mouse is to keep the mouse and the snake in separate cages.</p>
<p>One way to keep user A from accessing user B's sensitive data or dangerous functions is to keep each user's code in a separate sandbox. That is, create a separate JSContext and global object for each user, and always run each script in the appropriate context. When setting up a new global object, simply don't define any functions the user shouldn't have access to. This approach is called object-capabilities security. To learn more about it, <a title="http://www.youtube.com/watch?v=EGX2I31OhBE" class=" external" rel="external" href="http://www.youtube.com/watch?v=EGX2I31OhBE" target="_blank">watch the movie</a> or <a class=" external" rel="external" href="http://www.erights.org/talks/thesis/" title="http://www.erights.org/talks/thesis/" target="_blank">read the book</a>.</p>
<p>The metaphor is misleading in one regard: the snake can't reach the mouse because there's a physical barrier in the way. With SpiderMonkey the situation is more subtle. There's no barrier; there's just no way to get there from here. How can a malicious script get a reference to an object from another sandbox? It might as well be in a parallel universe. Even global variables are per-sandbox. There is no <code>getObjectFromOtherSandbox()</code> function. Your application just needs to take care not to expose any such function to scripts.</p>
<p>In short, never pass one user's data and objects to another user's code, and you'll have no access control issues. SpiderMonkey won't do it if you don't.</p>
<p><strong>Trade-offs.</strong> Object-capabilities security is security without run-time security checks. It is easy to implement, easy to reason about, and fast. But in fairness there are some drawbacks. First, the failure mode is pretty severe. If you do accidentally leak an object from one sandbox into another, the genie is out of the bottle. Once a malicious script gets a reference to a single object in a sandbox, it can use that object to get a reference to the sandbox's global object, and from there, almost any other object or function in that sandbox. There is no way to fix it except to destroy both sandboxes and start over. A second drawback is that the system doesn't automatically respond to <em>changes</em> in user privileges. Suppose user A is not an administrator, so you set up sandbox A with no administrator functionality. If you promote user A to be an admin, SpiderMonkey won't magically update sandbox A to have the administrator classes and functions you didn't define before. Your application will have to do that explicitly. Conversely, if you want to <em>strip</em> user A's administrator privileges, but you have already given administrator functions to user A's scripts, that's even worse. You have no choice but to destroy user A's sandbox and start over.</p>
</div><div id="section_34"><span id="Fine-grained_security"></span><h4 class="editable">Fine-grained security</h4>
<p>Another way to keep a snake from eating a mouse is to watch the snake constantly, and if it tries to eat the mouse, intervene.</p>
<p>SpiderMonkey is designed to support custom, application-defined security models. For example, the Firefox browser has a complex and powerful security model. Some JavaScript code ("chrome") has full access to the system. Scripts from web pages ("content") have very limited access. The <a class="external" rel="external" href="http://www.mozilla.org/projects/security/components/same-origin.html" title="http://www.mozilla.org/projects/security/components/same-origin.html" target="_blank">same origin policy</a> governs a script's access to data and functions from other web pages.</p>
<p>The SpiderMonkey security model is based on the Java principals security model. This model provides a common security interface, but the actual security implementation is up to you.</p>
<p>To use SpiderMonkey's fine-grained security features:</p>
<ul> <li> <p>Decide what security policy you want to enforce.</p> </li> <li> <p>Insert a call to <code><a title="en/JS_CheckAccess" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CheckAccess">JS_CheckAccess</a></code> at each point in your application where a security check is necessary. (Some security checks are also built into the JavaScript engine; you must decide what security policy to enforce for each of these checks.)</p> </li> <li> <p>Implement one or more <code><a title="en/JSPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSPrincipals">JSPrincipals</a></code> objects in your application. You need one <code>JSPrincipals</code> object for each different set of privileges that a script might have.</p> </li> <li> <p>When compiling or executing code, use the JSAPI functions that attach principals to the compiled code. These functions have <code>ForPrincipals</code> in the name. They are listed below. The purpose of using these functions is to ensure that your access check callbacks have accurate information about <em>who</em> is trying to access an object.</p> <table class="fullwidth-table" style="width: 839px; height: 166px;"> <tbody> <tr> <th>Function</th> <th>Purpose</th> </tr> <tr> <td><code><a title="en/JS_CompileScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScriptForPrincipals">JS_CompileScriptForPrincipals</a></code>,<br> <code><a title="en/JS_CompileScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileScriptForPrincipals">JS_CompileUCScriptForPrincipals</a></code>,<br> <code><a title="en/JS_CompileFileHandle" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFileHandle">JS_CompileFileHandleForPrincipals</a></code></td> <td>Compile a script with security information. (To execute a compiled script, use <code><a title="en/JS_ExecuteScript" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_ExecuteScript">JS_ExecuteScript</a></code>.)</td> </tr> <tr> <td><code><a title="en/JS_CompileFunctionForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunctionForPrincipals">JS_CompileFunctionForPrincipals</a></code>,<br> <code><a title="en/JS_CompileFunctionForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_CompileFunctionForPrincipals">JS_CompileUCFunctionForPrincipals</a></code></td> <td>Create a JavaScript function with security information.</td> </tr> <tr> <td><code><a title="en/JS_EvaluateScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScriptForPrincipals">JS_EvaluateScriptForPrincipals</a></code>,<br> <code><a title="en/JS_EvaluateScriptForPrincipals" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_EvaluateScriptForPrincipals">JS_EvaluateUCScriptForPrincipals</a></code></td> <td>Compile and execute a script with security information.</td> </tr> </tbody> </table> </li> <li> <p>Implement access check callback functions (see <code><a title="en/JSClass.checkAccess" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JSClass.checkAccess">JSClass.checkAccess</a></code> and <code><a title="en/JS_SetCheckObjectAccessCallback" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetCheckObjectAccessCallback">JS_SetCheckObjectAccessCallback</a></code>). These will be called from <code>JS_CheckAccess</code> and sometimes from within the JavaScript engine. An access check callback function can use jsdbgapi.h functions such as <code><a title="en/JS_FrameIterator" rel="internal" href="https://developer.mozilla.org/en/JS_FrameIterator">JS_FrameIterator</a></code> and <code><a title="en/JS_StackFramePrincipals" rel="internal" href="https://developer.mozilla.org/en/JS_StackFramePrincipals">JS_StackFramePrincipals</a></code> to obtain the principals of the code that is trying to perform the checked operation. Then it determines whether to allow the operation to proceed.</p> </li>
</ul>
</div></div><div id="section_35"><span id="Tracing_and_Profiling"></span><h3 class="editable">Tracing and Profiling</h3>
<p>There are features provided by&nbsp;the JSAPI&nbsp;that make it easier to implement JavaScript tracers and profilers.</p>
<div id="section_36"><span id="Function_tracing"></span><h4 class="editable">Function tracing</h4>
<p>If you configure with --enable-trace-jscalls, you can use <a title="en/SpiderMonkey/JSAPI Reference/JS SetFunctionCallback" rel="internal" href="https://developer.mozilla.org/en/SpiderMonkey/JSAPI_Reference/JS_SetFunctionCallback"><code>JS_SetFunctionCallback()</code></a>&nbsp;to set up a C function to be called whenever a JavaScript function is about to be called, or has finished executing:</p>

          <div class="dp-highlighter"><div class="bar"><div class="tools"><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" onclick="dp.sh.Toolbar.Command(&#39;ViewSource&#39;,this);return false;">view plain</a><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" onclick="dp.sh.Toolbar.Command(&#39;PrintSource&#39;,this);return false;">print</a><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" onclick="dp.sh.Toolbar.Command(&#39;About&#39;,this);return false;">?</a></div></div><ol start="1" class="dp-cpp"><li class="alt"><span><span class="keyword">void</span><span>&nbsp;funcTransition(</span><span class="keyword">const</span><span>&nbsp;JSFunction&nbsp;*func,&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;JSScript&nbsp;*scr,&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;JSContext&nbsp;*const_cx,&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSBool&nbsp;entering)&nbsp;&nbsp;</span></li><li class="alt"><span>{&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;JSContext&nbsp;*cx&nbsp;=&nbsp;<span class="keyword">const_cast</span><span>&lt;JSContext*&gt;(const_cx);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;JSString&nbsp;*name&nbsp;=&nbsp;JS_GetFunctionId((JSFunction*)func);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>&nbsp;*entExit;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;<span class="keyword">const</span><span>&nbsp;</span><span class="datatypes">char</span><span>&nbsp;*nameStr;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="comment">/*&nbsp;build&nbsp;a&nbsp;C&nbsp;string&nbsp;for&nbsp;the&nbsp;function's&nbsp;name&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!name)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;nameStr&nbsp;=&nbsp;<span class="string">"Unnamed&nbsp;function"</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;nameStr&nbsp;=&nbsp;JS_EncodeString(cx,&nbsp;name);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="comment">/*&nbsp;build&nbsp;a&nbsp;string&nbsp;for&nbsp;whether&nbsp;we're&nbsp;entering&nbsp;or&nbsp;exiting&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(entering)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;entExit&nbsp;=&nbsp;<span class="string">"Entering"</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;entExit&nbsp;=&nbsp;<span class="string">"Exiting"</span><span>;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;<span class="comment">/*&nbsp;output&nbsp;information&nbsp;about&nbsp;the&nbsp;trace&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;printf(<span class="string">"%s&nbsp;JavaScript&nbsp;function:&nbsp;%s&nbsp;at&nbsp;time:&nbsp;%ld"</span><span>,&nbsp;entExit,&nbsp;nameStr,&nbsp;clock());&nbsp;&nbsp;</span></span></li><li class=""><span>}&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span><span class="keyword">void</span><span>&nbsp;enableTracing(JSContext&nbsp;*cx)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;JS_SetFunctionCallback(cx,&nbsp;funcTransition);&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span><span class="keyword">void</span><span>&nbsp;disableTracing(JSContext&nbsp;*cx)&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;JS_SetFunctionCallback(cx,&nbsp;NULL);&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li></ol></div><pre name="code" class="c" style="display: none; ">void funcTransition(const JSFunction *func,
                    const JSScript *scr,
                    const JSContext *const_cx,
                    JSBool entering)
{
  JSContext *cx = const_cast&lt;JSContext*&gt;(const_cx);
  JSString *name = JS_GetFunctionId((JSFunction*)func);
  const char *entExit;
  const char *nameStr;

  /* build a C string for the function's name */

  if (!name) {
    nameStr = "Unnamed function";
  } else {
    nameStr = JS_EncodeString(cx, name);
  }

  /* build a string for whether we're entering or exiting */

  if (entering) {
    entExit = "Entering";
  } else {
    entExit = "Exiting";
  }

  /* output information about the trace */

  printf("%s JavaScript function: %s at time: %ld", entExit, nameStr, clock());
} 

void enableTracing(JSContext *cx) {
  JS_SetFunctionCallback(cx, funcTransition);
}

void disableTracing(JSContext *cx) {
  JS_SetFunctionCallback(cx, NULL);
}</pre>
        
<p></p></div></div></div></div></div>
            <section class="page-meta">
                  <section id="page-tags">
            <h2>Tags <span class="sub">(3)</span></h2>
              <a href="https://developer.mozilla.org/index.php?title=Special:Tags&pageId=8704" class="disabled" onclick="return false;" id="deki-page-tags-toggleview">Edit tags</a>              <div id="deki-page-tags"><ul class="tags"><li><a href="https://developer.mozilla.org/Special:Tags?tag=JavaScript" title="JavaScript" tagid="3" class="text">JavaScript</a></li><li><a href="https://developer.mozilla.org/Special:Tags?tag=NeedsTechnicalReview" title="NeedsTechnicalReview" tagid="17" class="text">NeedsTechnicalReview</a></li><li><a href="https://developer.mozilla.org/Special:Tags?tag=SpiderMonkey" title="SpiderMonkey" tagid="86" class="text">SpiderMonkey</a></li></ul></div>          </section>
        
                  <section id="page-files">
            <h2>Attachments <span class="sub">(0)</span></h2>
            <div id="pageFiles"><div class="nofiles">&nbsp;</div></div>            <div id="deki-image-gallery-lite"><table class="table empty" width="100%" cellspacing="0" cellpadding="0" border="0"><colgroup><col width="33%"><col width="33%"><col width="33%"></colgroup><tbody><tr class="bg1"><th class="col1" colspan="3">Images 0</th></tr><tr class="bg2"><td class="col1 empty" colspan="3">No images to display in the gallery.</td></tr></tbody></table></div>            <p class="add"><a title="Attach file" class="disabled ">Attach file</a></p>
          </section>
        
                        
        </section>
        </div>

    </article>

    <p class="last-mod hideforedit">
      Page last modified <a href="https://developer.mozilla.org/index.php?title=En/SpiderMonkey/JSAPI_User_Guide&action=history" title="22:26, 28 Aug 2011">22:26, 28 Aug 2011</a> by <a href="https://developer.mozilla.org/User:Mark_Giffin" class="link-user" rel="internal">Mark Giffin</a>    </p>

  </div><!-- /#content-main -->

</div><!-- /.wrap -->
</section><!-- /#content -->



<footer id="site-info" role="contentinfo">
<div class="wrap">
  <div id="legal">
    <img src="./JSAPI User Guide - MDN_files/mdn-logo-tiny.png" alt="" width="42" height="48">
    <p id="copyright">© 2011 Mozilla Developer Network</p>
    <p>Content is available under <a href="https://developer.mozilla.org/Project:Copyrights">these licenses</a> • <a href="https://developer.mozilla.org/Project:en/About">About MDN</a> • <a href="http://www.mozilla.org/about/policies/privacy-policy.html">Privacy Policy</a> • <a href="https://developer.mozilla.org/Project:en/Using_the_Mozilla_Developer_Center">Help</a></p>
  </div>
  <p class="user-state superfish">
          <a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&returntotitle=En%2FSpiderMonkey%2FJSAPI+User+Guide" class="user-login">Log in</a> | 	<a href="https://developer.mozilla.org/index.php?title=Special:Userlogin&register=true" title="Join MDN">Join MDN</a>
      
  </p>
</div>
</footer>


			
<div class="ui-msg-wrap" id="MTMessage" style="display: none;">
	<div class="ui-msg ui-errormsg" id="MTMessageStyle">
		<div class="ui-msg-opt">
			<ul>
				<li><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" class="dismiss" onclick="return MTMessage.Hide();">dismiss message</a></li>
				<li><a href="https://developer.mozilla.org/En/SpiderMonkey/JSAPI_User_Guide#" class="details" id="MTMessageDetailsLink" onclick="return MTMessage.ShowDetails(this);">view details</a></li>
			</ul>
			<div class="ui-msg-autoclose">
				<span id="MTMessageUnpaused" style="display: inline;">Message will close by itself in <span id="MTMessageTimer"></span> seconds</span>
				<span id="MTMessagePaused" style="display: none;">Message timer has been stopped</span>
			</div>
		</div>
		<div class="ui-msg-header" id="MTMessageHeader"></div>
		<div class="ui-msg-desc" id="MTMessageDesc"></div>
		<div class="ui-msg-desc" id="MTMessageDetails" style="display: none;">
			<p>Viewing Details:</p>
		</div>
	</div>
</div><script type="text/javascript">$(function() {var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");$.getScript(gaJsHost + "google-analytics.com/ga.js", function() {try {var pageTracker = _gat._getTracker("UA-68075-16");pageTracker._setDomainName(".mindtouch.com");pageTracker._trackPageview();} catch(e) {}});});</script>
<!-- Served by pm-dekiwiki03.mozilla.org in 5.24 secs. -->
<!--
	Verb      Path                                              Time(ms)       API Stats
	GET       /deki/site/settings                                   5.18       request-time-ms=2; mysql-queries=1; mysql-time-ms=0; cache-ratio=0.00; cache-hit=0; cache-miss=-1; cache-del=0; cache-ins=1;
	GET       /deki/users/=Anonymous                                7.62       request-time-ms=5; mysql-queries=4; mysql-time-ms=3; cache-ratio=-0.67; cache-hit=2; cache-miss=-5; cache-del=0; cache-ins=5;
	GET       /deki/license                                         7.41       request-time-ms=3; mysql-queries=2; mysql-time-ms=1; cache-ratio=-0.50; cache-hit=1; cache-miss=-3; cache-del=0; cache-ins=3;
	GET       /deki/pages/8704/contents                         4,779.37       request-time-ms=4776; mysql-queries=36; mysql-time-ms=61; cache-ratio=3.77; cache-hit=49; cache-miss=-36; cache-del=0; cache-ins=36;
	GET       /deki/pages/8704                                     77.12       request-time-ms=65; mysql-queries=21; mysql-time-ms=35; cache-ratio=25.00; cache-hit=25; cache-miss=-24; cache-del=0; cache-ins=24;
	GET       /deki/pages/8704/info                                 6.64       request-time-ms=4; mysql-queries=3; mysql-time-ms=3; cache-ratio=-0.67; cache-hit=2; cache-miss=-5; cache-del=0; cache-ins=5;
	GET       /deki/pages/8704/tags                                 8.93       request-time-ms=7; mysql-queries=5; mysql-time-ms=4; cache-ratio=-0.75; cache-hit=3; cache-miss=-7; cache-del=0; cache-ins=7;
	GET       /deki/site/properties                                10.08       request-time-ms=7; mysql-queries=4; mysql-time-ms=5; cache-ratio=-0.25; cache-hit=1; cache-miss=-5; cache-del=0; cache-ins=5;
	GET       /deki/site/nav/=En%252FSpiderMonkey%252FJSAPI%2BUser%2BGuide/full   242.53       request-time-ms=240; mysql-queries=6; mysql-time-ms=236; cache-ratio=-6.00; cache-hit=6; cache-miss=-7; cache-del=0; cache-ins=7;
	GET       /deki/pages/8704/tags                                 8.55       request-time-ms=7; mysql-queries=5; mysql-time-ms=5; cache-ratio=-0.75; cache-hit=3; cache-miss=-7; cache-del=0; cache-ins=7;
	                                                             =======
	                                                     Total: 5,153.44      
	                                                     Ideal: 5,144.89      
-->
 
<div id="popupMessage"></div> <div id="popupMask"></div>
<div id="menuFiller"></div>
<div id="bodyHeight"></div>

<script src="./JSAPI User Guide - MDN_files/jsapi"></script>
<script src="./JSAPI User Guide - MDN_files/javascript.min.js"></script><script src="./JSAPI User Guide - MDN_files/saved_resource" type="text/javascript"></script><script src="./JSAPI User Guide - MDN_files/default+en.I.js" type="text/javascript"></script>

 
<script type="text/javascript">
//<![CDATA[
var _tag=new WebTrends();
_tag.dcsGetId();
// Add custom parameters here.
//_tag.DCSext.param_name=param_value;
_tag.dcsCollect();
//]]>>
</script>
<noscript>
&lt;div&gt;&lt;img alt="DCSIMG" id="DCSIMG" width="1" height="1" src="https://statse.webtrendslive.com/dcs8yrjuavz5bdaun34r2o8bi_8o8x/njs.gif?dcsuri=/nojavascript&amp;amp;WT.js=No&amp;amp;WT.tv=8.6.2"/&gt;&lt;/div&gt;
</noscript>
<!-- END OF SmartSource Data Collector TAG -->

<script type="text/javascript">/*<![CDATA[*/$(function(){dp.SyntaxHighlighter.HighlightAll('code');});/*]]>*/</script> 


</body></html>