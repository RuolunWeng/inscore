#
# makefile for testing the INScore engine output
# the principle is the following:
# an image target generates image files using guido2image for all gmn files
# in gmn-examples and in regression-tests
# 
# a validate target makes the comparison of files generated by different versions
#

format		= pdf

version	= $(shell ./INScoreVersion | cut -d' ' -f 3)
pwd	  = $(shell pwd)
files = $(shell find . -name "*.inscore")
out  := $(patsubst ./%.inscore, $(version)/%.$(format), $(files))



images: forcepdfdate INScoreVersion
	@echo "Make sure that INScoreViewer is running!"
	make files

help:
	@echo "Makefile for testing the INScore engine output. Available targets are:"
	@echo "'images' (default): makes pdf files for inscore files recursively enclosed in this folder"
	@echo "                    the pdf files output folder name is the current INScore version number."
	@echo "'validate VERSION=another_version': compares the current version with another one"

validate: $(out)
	@echo Validating version $(VERSION) with $(version)
	
files: $(out)
	./forcepdfdate 20100101120000 $(out)

$(version)/%.$(format): %.inscore
	@[ -d $(@D) ] || mkdir -p $(@D)
	./inscore2pdf $< $@

%.out: %.pdf
	@diff $< $(patsubst $(version)/%, $(VERSION)/%, $<) || echo "open $<  $(patsubst $(version)/%, $(VERSION)/%, $<) to check changes"
	
