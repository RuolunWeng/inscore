<!doctype html>
<html>
	<head>
		<script>
var ws;
var username;
var msg;
 
function updateStatus(id, message) {
	document.getElementById(id).innerHTML = message;
}
 
function loadWebSocket() {
	if (window.WebSocket) {
		var url = "ws://localhost:1234";
		ws = new WebSocket(url);
 
		updateStatus("wsStatus", "webSocket supported !");
		ws.onopen = function() {
			updateStatus("wsStatus", "Connected to WebSocket server!");
		}
		ws.onmessage = function(e) {
			if (e.data instanceof Blob) {
				renderImg(e);
			} else {
				displayMessage(e.data);
				// Automatic refresh
				ws.send("getImage");
			}
		}
		ws.onclose = function() {
			updateStatus("wsStatus", "WebSocket closed!");
		}
		ws.onerror = function(e) {
			updateStatus("wsStatus", "WebSocket error : " + e.data);
		}
	} else {
		updateStatus("wsStatus", "Your browser does NOT support webSocket.");
	}
}

// Render the downloaded image
function renderImg(evt) {
	var url = URL.createObjectURL(evt.data);
	var img = document.getElementById("image");
	img.src = url;
 }
 
function displayMessage(message) {
	// Display text message under form with the date.
	document.getElementById("message").innerHTML =  new Date() + " " + message;
}
</script>
	</head>
	<body onload="loadWebSocket()">
		<div>
			<div>Screenshot of the scene served by a websocket server.</div>
			<div><span id="message"></span></div>
			<p></p>
			<img style="border : 1px solid black;" id="image" src=""/>
		</div>
		<div>Status : <span id="wsStatus"></span></div>
	</body>
</html>

